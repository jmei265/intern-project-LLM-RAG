MatricesEnterpriseMobileICSTacticsEnterpriseMobileICSTechniquesEnterpriseMobileICSDefensesData SourcesMitigationsEnterpriseMobileICSAssetsCTIGroupsSoftwareCampaignsResourcesGet StartedLearn More about ATT&CKATT&CKconATT&CK Data & ToolsFAQEngage with ATT&CKVersion HistoryLegal & BrandingBenefactorsBlogSearchATT&CKcon 5.0 returns October 22-23, 2024 in McLean, VA.Register heretoday!HomeTechniquesEnterpriseAccess Token ManipulationToken Impersonation/TheftAccess Token Manipulation:Token Impersonation/TheftOther sub-techniques of Access Token Manipulation (5)IDNameT1134.001Token Impersonation/TheftT1134.002Create Process with TokenT1134.003Make and Impersonate TokenT1134.004Parent PID SpoofingT1134.005SID-History InjectionAdversaries may duplicate then impersonate another user's existing token to escalate privileges and bypass access controls. For example, an adversary can duplicate an existing token usingDuplicateTokenorDuplicateTokenEx.[1]The token can then be used withImpersonateLoggedOnUserto allow the calling thread to impersonate a logged on user's security context, or withSetThreadTokento assign the impersonated token to a thread.An adversary may performToken Impersonation/Theftwhen they have a specific, existing process they want to assign the duplicated token to. For example, this may be useful for when the target user has a non-network logon session on the system.When an adversary would instead use a duplicated token to create a new process rather than attaching to an existing process, they can additionallyCreate Process with TokenusingCreateProcessWithTokenWorCreateProcessAsUserW.Token Impersonation/Theftis also distinct fromMake and Impersonate Tokenin that it refers to duplicating an existing token, rather than creating a new one.ID:T1134.001Sub-technique of:T1134ⓘTactics:Defense Evasion,Privilege EscalationⓘPlatforms:WindowsⓘDefense Bypassed:File system access controls, System access controls, Windows User Account ControlContributors:Jonny JohnsonVersion:1.2Created:18 February 2020Last Modified:10 January 2024Version PermalinkLive VersionProcedure ExamplesIDNameDescriptionG0007APT28APT28has used CVE-2015-1701 to access the SYSTEM token and copy it into the current process as part of privilege escalation.[2]S0456Aria-bodyAria-bodyhas the ability to duplicate a token from ntprint.exe.[3]S1081BADHATCHBADHATCHcan impersonate alsass.exeorvmtoolsd.exetoken.[4]S0570BitPaymerBitPaymercan use the tokens of users to create processes on infected systems.[5]S0154Cobalt StrikeCobalt Strikecan steal access tokens from exiting processes.[6][7]S0367EmotetEmotethas the ability to duplicate the user’s token.[8]G0061FIN8FIN8has used a malicious framework designed to impersonate the lsass.exe/vmtoolsd.exe token.[9][10]S0182FinFisherFinFisheruses token manipulation with NtFilterToken as part of UAC bypass.[11][12]S0439OkrumOkrumcan impersonate a logged-on user's security context using a call to the ImpersonateLoggedOnUser API.[13]S0192PupyPupycan obtain a list of SIDs and provide the option for selecting process tokens to impersonate.[14]S0496REvilREvilcan obtain the token from the user that launched the explorer.exe process to avoid affecting the desktop of the SYSTEM user.[15]S0140ShamoonShamooncan impersonate tokens usingLogonUser,ImpersonateLoggedOnUser, andImpersonateNamedPipeClient.[16]S0692SILENTTRINITYSILENTTRINITYcan find a process owned by a specific user and impersonate the associated token.[17]S0623SiloscapeSiloscapeimpersonates the main thread ofCExecSvc.exeby callingNtImpersonateThread.[18]S0603StuxnetStuxnetattempts to impersonate an anonymous token to enumerate bindings in the service control manager.[19]S1011TarraskTarraskleverages token theft to obtainlsass.exesecurity permissions.[20]MitigationsIDMitigationDescriptionM1026Privileged Account ManagementLimit permissions so that users and user groups cannot create tokens. This setting should be defined for the local system account only. GPO: Computer Configuration > [Policies] > Windows Settings > Security Settings > Local Policies > User Rights Assignment: Create a token object.[21]Also define who can create a process level token to only the local and network service through GPO: Computer Configuration > [Policies] > Windows Settings > Security Settings > Local Policies > User Rights Assignment: Replace a process level token.[22]Administrators should log in as a standard user but run their tools with administrator privileges using the built-in access token manipulation commandrunas.[23]M1018User Account ManagementAn adversary must already have administrator level access on the local system to make full use of this technique; be sure to restrict users and accounts to the least privileges they require.DetectionIDData SourceData ComponentDetectsDS0017CommandCommand ExecutionMonitor executed commands and arguments to detect token manipulation by auditing command-line activity. Specifically, analysts should look for use of the runas command. Detailed command-line logging is not enabled by default in Windows.[24]DS0009ProcessOS API ExecutionMonitor for API calls associated with other suspicious behavior to reduce false positives that may be due to normal benign use by users and administrators, such as DuplicateToken(Ex), ImpersonateLoggedOnUser , and SetThreadToken.ReferencesMicrosoft. (2021, October 12). DuplicateToken function (securitybaseapi.h). Retrieved January 8, 2024.FireEye Labs. (2015, April 18). Operation RussianDoll: Adobe & Windows Zero-Day Exploits Likely Leveraged by Russia’s APT28 in Highly-Targeted Attack. Retrieved April 24, 2017.CheckPoint. (2020, May 7). Naikon APT: Cyber Espionage Reloaded. Retrieved May 26, 2020.Vrabie, V., et al. (2021, March 10). FIN8 Returns with Improved BADHATCH Toolkit. Retrieved September 8, 2021.Frankoff, S., Hartley, B. (2018, November 14). Big Game Hunting: The Evolution of INDRIK SPIDER From Dridex Wire Fraud to BitPaymer Targeted Ransomware. Retrieved January 6, 2021.Strategic Cyber LLC. (2017, March 14). Cobalt Strike Manual. Retrieved May 24, 2017.Strategic Cyber LLC. (2020, November 5). Cobalt Strike: Advanced Threat Tactics for Penetration Testers. Retrieved April 13, 2021.Binary Defense. (n.d.). Emotet Evolves With new Wi-Fi Spreader. Retrieved September 8, 2023.Martin Zugec. (2021, July 27). Deep Dive Into a FIN8 Attack - A Forensic Investigation. Retrieved September 1, 2021.Symantec Threat Hunter Team. (2023, July 18). FIN8 Uses Revamped Sardonic Backdoor to Deliver Noberus Ransomware. Retrieved August 9, 2023.FinFisher. (n.d.). Retrieved December 20, 2017.Allievi, A.,Flori, E. (2018, March 01). FinFisher exposed: A researcher’s tale of defeating traps, tricks, and complex virtual machines. Retrieved July 9, 2018.Hromcova, Z. (2019, July). OKRUM AND KETRICAN: AN OVERVIEW OF RECENT KE3CHANG GROUP ACTIVITY. Retrieved May 6, 2020.Nicolas Verdier. (n.d.). Retrieved January 29, 2018.McAfee. (2019, October 2). McAfee ATR Analyzes Sodinokibi aka REvil Ransomware-as-a-Service – What The Code Tells Us. Retrieved August 4, 2020.Mundo, A., Roccia, T., Saavedra-Morales, J., Beek, C.. (2018, December 14). Shamoon Returns to Wipe Systems in Middle East, Europe . Retrieved May 29, 2020.Salvati, M. (2019, August 6). SILENTTRINITY Modules. Retrieved March 24, 2022.Prizmant, D. (2021, June 7). Siloscape: First Known Malware Targeting Windows Containers to Compromise Cloud Environments. Retrieved June 9, 2021.Nicolas Falliere, Liam O Murchu, Eric Chien 2011, February W32.Stuxnet Dossier (Version 1.4) Retrieved. 2017/09/22Microsoft Threat Intelligence Team & Detection and Response Team . (2022, April 12). Tarrask malware uses scheduled tasks for defense evasion. Retrieved June 1, 2022.Brower, N., Lich, B. (2017, April 19). Create a token object. Retrieved December 19, 2017.Brower, N., Lich, B. (2017, April 19). Replace a process level token. Retrieved December 19, 2017.Microsoft TechNet. (n.d.). Runas. Retrieved April 21, 2017.Mathers, B. (2017, March 7). Command line process auditing. Retrieved April 21, 2017.×load more resultsContact UsTerms of UsePrivacy PolicyWebsite Changelog© 2015 - 2024, The MITRE Corporation. MITRE ATT&CK and ATT&CK are registered trademarks of The MITRE Corporation.