MatricesEnterpriseMobileICSTacticsEnterpriseMobileICSTechniquesEnterpriseMobileICSDefensesData SourcesMitigationsEnterpriseMobileICSAssetsCTIGroupsSoftwareCampaignsResourcesGet StartedLearn More about ATT&CKATT&CKconATT&CK Data & ToolsFAQEngage with ATT&CKVersion HistoryLegal & BrandingBenefactorsBlogSearchATT&CKcon 5.0 returns October 22-23, 2024 in McLean, VA.Register heretoday!HomeTechniquesEnterpriseHijack Execution FlowDLL Search Order HijackingHijack Execution Flow:DLL Search Order HijackingOther sub-techniques of Hijack Execution Flow (13)IDNameT1574.001DLL Search Order HijackingT1574.002DLL Side-LoadingT1574.004Dylib HijackingT1574.005Executable Installer File Permissions WeaknessT1574.006Dynamic Linker HijackingT1574.007Path Interception by PATH Environment VariableT1574.008Path Interception by Search Order HijackingT1574.009Path Interception by Unquoted PathT1574.010Services File Permissions WeaknessT1574.011Services Registry Permissions WeaknessT1574.012COR_PROFILERT1574.013KernelCallbackTableT1574.014AppDomainManagerAdversaries may execute their own malicious payloads by hijacking the search order used to load DLLs. Windows systems use a common method to look for required DLLs to load into a program.[1][2]Hijacking DLL loads may be for the purpose of establishing persistence as well as elevating privileges and/or evading restrictions on file execution.There are many ways an adversary can hijack DLL loads. Adversaries may plant trojan dynamic-link library files (DLLs) in a directory that will be searched before the location of a legitimate library that will be requested by a program, causing Windows to load their malicious library when it is called for by the victim program. Adversaries may also perform DLL preloading, also called binary planting attacks,[3]by placing a malicious DLL with the same name as an ambiguously specified DLL in a location that Windows searches before the legitimate DLL. Often this location is the current working directory of the program.[4]Remote DLL preloading attacks occur when a program sets its current directory to a remote location such as a Web share before loading a DLL.[5]Phantom DLL hijacking is a specific type of DLL search order hijacking where adversaries target references to non-existent DLL files.[6]They may be able to load their own malicious DLL by planting it with the correct name in the location of the missing module.Adversaries may also directly modify the search order via DLL redirection, which after being enabled (in the Registry and creation of a redirection file) may cause a program to load a different DLL.[7][8][9]If a search order-vulnerable program is configured to run at a higher privilege level, then the adversary-controlled DLL that is loaded will also be executed at the higher level. In this case, the technique could be used for privilege escalation from user to administrator or SYSTEM or from administrator to SYSTEM, depending on the program. Programs that fall victim to path hijacking may appear to behave normally because malicious DLLs may be configured to also load the legitimate DLLs they were meant to replace.ID:T1574.001Sub-technique of:T1574ⓘTactics:Persistence,Privilege Escalation,Defense EvasionⓘPlatforms:WindowsContributors:Ami Holeston, CrowdStrike; Marina Liang; Stefan Kanthak; Travis Smith, Tripwire; Will Alexander, CrowdStrikeVersion:1.2Created:13 March 2020Last Modified:28 April 2024Version PermalinkLive VersionProcedure ExamplesIDNameDescriptionG0096APT41APT41has used search order hijacking to execute malicious payloads, such as Winnti RAT.[10]G0143Aquatic PandaAquatic Pandahas used DLL search-order hijacking to loadexe,dll, anddatfiles into memory.[11]S0373AstarothAstarothcan launch itself via DLL Search Order Hijacking.[12]G0135BackdoorDiplomacyBackdoorDiplomacyhas executed DLL search order hijacking.[13]S0415BOOSTWRITEBOOSTWRITEhas exploited the loading of the legitimate Dwrite.dll file by actually loading the gdi library, which then loads the gdiplus library and ultimately loads the local Dwrite dll.[14]S1063Brute Ratel C4Brute Ratel C4has used search order hijacking to load a malicious payload DLL as a dependency to a benign application packaged in the same ISO.[15]S0631ChaesChaeshas used search order hijacking to load a malicious DLL.[16]G1021Cinnamon TempestCinnamon Tempesthas used search order hijacking to launchCobalt StrikeBeacons.[17][18]S0538CrutchCrutchcan persist via DLL search order hijacking on Google Chrome, Mozilla Firefox, or Microsoft OneDrive.[19]S0134DowndelphDowndelphuses search order hijacking of the Windows executable sysprep.exe to escalate privileges.[20]S0363EmpireEmpirecontains modules that can discover and exploit various DLL hijacking opportunities.[21]G0120EvilnumEvilnumhas used the malware variant, TerraTV, to load a malicious DLL placed in the TeamViewer directory, instead of the original Windows DLL located in a system folder.[22]S0182FinFisherAFinFishervariant uses DLL search order hijacking.[23][24]S0661FoggyWebFoggyWeb's loader has used DLL Search Order Hijacking to load malicious code instead of the legitimateversion.dllduring theMicrosoft.IdentityServer.ServiceHost.exeexecution process.[25]S0009HikitHikithas usedDLL Search Order Hijackingto loadoci.dllas a persistence mechanism.[26]S0070HTTPBrowserHTTPBrowserabuses the Windows DLL load order by using a legitimate Symantec anti-virus binary, VPDN_LU.exe, to load a malicious DLL that mimics a legitimate Symantec DLL, navlu.dll.[27]S1097HUI LoaderHUI Loadercan be deployed to targeted systems via legitimate programs that are vulnerable to DLL search order hijacking.[18]S0260InvisiMoleInvisiMolecan be launched by using DLL search order hijacking in which the wrapper DLL is placed in the same folder as explorer.exe and loaded during startup into the Windows Explorer process instead of the legitimate library.[28]S0530MelcozMelcozcan use DLL hijacking to bypass security controls.[12]G0045menuPassmenuPasshas used DLL search order hijacking.[29]S0280MirageFoxMirageFoxis likely loaded via DLL hijacking into a legitimate McAfee binary.[30]S0013PlugXPlugXhas the ability to use DLL search order hijacking for installation on targeted systems.[31]S0194PowerSploitPowerSploitcontains a collection of Privesc-PowerUp modules that can discover and exploit DLL hijacking opportunities in services and processes.[32][33]S0113PrikormkaPrikormkauses DLL search order hijacking for persistence by saving itself as ntshrui.dll to the Windows directory so it will load before the legitimate ntshrui.dll saved in the System32 subdirectory.[34]S0458RamsayRamsaycan hijack outdated Windows application dependencies with malicious versions of its own DLL payload.[35]S0153RedLeavesRedLeavesis launched through use of DLL search order hijacking to load a malicious dll.[36]G0048RTMRTMhas used search order hijacking to force TeamViewer to load a malicious DLL.[37]G0027Threat Group-3390Threat Group-3390has performed DLL search order hijacking to execute their payload.[38]G0131Tonto TeamTonto Teamabuses a legitimate and signed Microsoft executable to launch a malicious DLL.[39]S0612WastedLockerWastedLockerhas performed DLL hijacking before execution.[40]S0109WEBC2Variants ofWEBC2achieve persistence by using DLL search order hijacking, usually by copying the DLL file to%SYSTEMROOT%(C:\WINDOWS\ntshrui.dll).[41]G0107WhiteflyWhiteflyhas used search order hijacking to run the loader Vcrodat.[42]MitigationsIDMitigationDescriptionM1047AuditUse auditing tools capable of detecting DLL search order hijacking opportunities on systems within an enterprise and correct them. Toolkits like the PowerSploit framework contain PowerUp modules that can be used to explore systems for DLL hijacking weaknesses.[43]Use the program sxstrace.exe that is included with Windows along with manual inspection to check manifest files for side-by-side problems in software.[44]M1038Execution PreventionAdversaries may use new DLLs to execute this technique. Identify and block potentially malicious software executed through search order hijacking by using application control solutions capable of blocking DLLs loaded by legitimate software.M1044Restrict Library LoadingDisallow loading of remote DLLs. This is included by default in Windows Server 2012+ and is available by patch for XP+ and Server 2003+.Enable Safe DLL Search Mode to force search for system DLLs in directories with greater restrictions (e.g.%SYSTEMROOT%)to be used before local directory DLLs (e.g. a user's home directory)The Safe DLL Search Mode can be enabled via Group Policy at Computer Configuration > [Policies] > Administrative Templates > MSS (Legacy): MSS: (SafeDllSearchMode) Enable Safe DLL search mode. The associated Windows Registry key for this is located atHKLM\SYSTEM\CurrentControlSet\Control\Session Manager\SafeDLLSearchMode[45][1]DetectionIDData SourceData ComponentDetectsDS0022FileFile CreationMonitor newly constructed .manifest and .local redirection files that do not correlate with software updates.File ModificationMonitor for changed made to .manifest/.local redirection files, or file systems for moving, renaming, replacing, or modifying DLLs. Changes in the set of DLLs that are loaded by a process (compared with past behavior) that do not correlate with known software, patches, etc., are suspicious.DS0011ModuleModule LoadMonitor DLLs loaded into a process and detect DLLs that have the same file name but abnormal paths.ReferencesMicrosoft. (2018, May 31). Dynamic-Link Library Search Order. Retrieved November 30, 2014.Harbour, N. (2010, July 15). Malware Persistence without the Windows Registry. Retrieved November 17, 2020.OWASP. (2013, January 30). Binary planting. Retrieved June 7, 2016.Harbour, N. (2011, June 3). What the fxsst?. Retrieved November 17, 2020.Microsoft. (, May 23). Microsoft Security Advisory 2269637. Retrieved March 13, 2020.CrowdStrike, Falcon OverWatch Team. (2022, December 30). Retrieved October 19, 2023.Microsoft. (2018, May 31). Dynamic-Link Library Redirection. Retrieved March 13, 2020.Microsoft. (n.d.). Manifests. Retrieved December 5, 2014.Nick Harbour. (2010, September 1). DLL Search Order Hijacking Revisited. Retrieved March 13, 2020.Crowdstrike. (2020, March 2). 2020 Global Threat Report. Retrieved December 11, 2020.Wiley, B. et al. (2021, December 29). OverWatch Exposes AQUATIC PANDA in Possession of Log4Shell Exploit Tools During Hands-on Intrusion Attempt. Retrieved January 18, 2022.GReAT. (2020, July 14). The Tetrade: Brazilian banking malware goes global. Retrieved November 9, 2020.Adam Burgher. (2021, June 10). BackdoorDiplomacy: Upgrading from Quarian to Turian. Retrieved September 1, 2021Carr, N, et all. (2019, October 10). Mahalo FIN7: Responding to the Criminal Operators’ New Tools and Techniques. Retrieved October 11, 2019.Harbison, M. and Renals, P. (2022, July 5). When Pentest Tools Go Brutal: Red-Teaming Tool Being Abused by Malicious Actors. Retrieved February 1, 2023.Salem, E. (2020, November 17). CHAES: Novel Malware Targeting Latin American E-Commerce. Retrieved June 30, 2021.Microsoft. (2022, May 9). Ransomware as a service: Understanding the cybercrime gig economy and how to protect yourself. Retrieved March 10, 2023.Counter Threat Unit Research Team . (2022, June 23). BRONZE STARLIGHT RANSOMWARE OPERATIONS USE HUI LOADER. Retrieved December 7, 2023.Faou, M. (2020, December 2). Turla Crutch: Keeping the “back door” open. Retrieved December 4, 2020.ESET. (2016, October). En Route with Sednit - Part 3: A Mysterious Downloader. Retrieved November 21, 2016.Schroeder, W., Warner, J., Nelson, M. (n.d.). Github PowerShellEmpire. Retrieved April 28, 2016.Porolli, M. (2020, July 9). More evil: A deep look at Evilnum and its toolset. Retrieved January 22, 2021.FinFisher. (n.d.). Retrieved December 20, 2017.Kaspersky Lab's Global Research & Analysis Team. (2017, October 16). BlackOasis APT and new targeted attacks leveraging zero-day exploit. Retrieved February 15, 2018.Ramin Nafisi. (2021, September 27). FoggyWeb: Targeted NOBELIUM malware leads to persistent backdoor. Retrieved October 4, 2021.Glyer, C., Kazanciyan, R. (2012, August 20). The “Hikit” Rootkit: Advanced and Persistent Attack Techniques (Part 1). Retrieved June 6, 2016.Desai, D.. (2015, August 14). Chinese cyber espionage APT group leveraging recently leaked Hacking Team exploits to target a Financial Services Firm. Retrieved January 26, 2016.Hromcová, Z. (2018, June 07). InvisiMole: Surprisingly equipped spyware, undercover since 2013. Retrieved July 10, 2018.PwC and BAE Systems. (2017, April). Operation Cloud Hopper. Retrieved April 5, 2017.Rosenberg, J. (2018, June 14). MirageFox: APT15 Resurfaces With New Tools Based On Old Ones. Retrieved September 21, 2018.Raggi, M. et al. (2022, March 7). The Good, the Bad, and the Web Bug: TA416 Increases Operational Tempo Against European Governments as Conflict in Ukraine Escalates. Retrieved March 16, 2022.PowerShellMafia. (2012, May 26). PowerSploit - A PowerShell Post-Exploitation Framework. Retrieved February 6, 2018.PowerSploit. (n.d.). PowerSploit. Retrieved February 6, 2018.Cherepanov, A.. (2016, May 17). Operation Groundbait: Analysis of a surveillance toolkit. Retrieved May 18, 2016.Sanmillan, I.. (2020, May 13). Ramsay: A cyber‑espionage toolkit tailored for air‑gapped networks. Retrieved May 27, 2020.FireEye iSIGHT Intelligence. (2017, April 6). APT10 (MenuPass Group): New Tools, Global Campaign Latest Manifestation of Longstanding Threat. Retrieved June 29, 2017.Skulkin, O. (2019, August 5). Following the RTM Forensic examination of a computer infected with a banking trojan. Retrieved May 11, 2020.Pantazopoulos, N., Henry T. (2018, May 18). Emissary Panda – A potential new malicious tool. Retrieved June 25, 2018.Faou, M., Tartare, M., Dupuy, T. (2021, March 10). Exchange servers under siege from at least 10 APT groups. Retrieved May 21, 2021.Antenucci, S., Pantazopoulos, N., Sandee, M. (2020, June 23). WastedLocker: A New Ransomware Variant Developed By The Evil Corp Group. Retrieved September 14, 2021.Mandiant. (n.d.). Appendix C (Digital) - The Malware Arsenal. Retrieved July 18, 2016.Symantec. (2019, March 6). Whitefly: Espionage Group has Singapore in Its Sights. Retrieved May 26, 2020.PowerSploit. (n.d.). Retrieved December 4, 2014.Gerend, J. et al.. (2017, October 16). sxstrace. Retrieved April 26, 2021.Microsoft. (2010, August 12). More information about the DLL Preloading remote attack vector. Retrieved December 5, 2014.×load more resultsContact UsTerms of UsePrivacy PolicyWebsite Changelog© 2015 - 2024, The MITRE Corporation. MITRE ATT&CK and ATT&CK are registered trademarks of The MITRE Corporation.