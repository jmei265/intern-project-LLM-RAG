MatricesEnterpriseMobileICSTacticsEnterpriseMobileICSTechniquesEnterpriseMobileICSDefensesData SourcesMitigationsEnterpriseMobileICSAssetsCTIGroupsSoftwareCampaignsResourcesGet StartedLearn More about ATT&CKATT&CKconATT&CK Data & ToolsFAQEngage with ATT&CKVersion HistoryLegal & BrandingBenefactorsBlogSearchATT&CKcon 5.0 returns October 22-23, 2024 in McLean, VA.Register heretoday!HomeTechniquesEnterpriseBoot or Logon Initialization ScriptsLogon Script (Windows)Boot or Logon Initialization Scripts:Logon Script (Windows)Other sub-techniques of Boot or Logon Initialization Scripts (5)IDNameT1037.001Logon Script (Windows)T1037.002Login HookT1037.003Network Logon ScriptT1037.004RC ScriptsT1037.005Startup ItemsAdversaries may use Windows logon scripts automatically executed at logon initialization to establish persistence. Windows allows logon scripts to be run whenever a specific user or group of users log into a system.[1]This is done via adding a path to a script to theHKCU\Environment\UserInitMprLogonScriptRegistry key.[2]Adversaries may use these scripts to maintain persistence on a single system. Depending on the access configuration of the logon scripts, either local credentials or an administrator account may be necessary.ID:T1037.001Sub-technique of:T1037ⓘTactics:Persistence,Privilege EscalationⓘPlatforms:WindowsVersion:1.0Created:10 January 2020Last Modified:24 March 2020Version PermalinkLive VersionProcedure ExamplesIDNameDescriptionG0007APT28AnAPT28loader Trojan adds the Registry keyHKCU\Environment\UserInitMprLogonScriptto establish persistence.[3]S0438AttorAttor's dispatcher can establish persistence via adding a Registry key with a logon scriptHKEY_CURRENT_USER\Environment "UserInitMprLogonScript".[4]G0080Cobalt GroupCobalt Grouphas added persistence by registering the file name for the next stage malware underHKCU\Environment\UserInitMprLogonScript.[5]S0044JHUHUGITJHUHUGIThas registered a Windows shell script under the Registry keyHKCU\Environment\UserInitMprLogonScriptto establish persistence.[6][7]S0526KGH_SPYKGH_SPYhas the ability to set theHKCU\Environment\UserInitMprLogonScriptRegistry key to execute logon scripts.[8]S0251ZebrocyZebrocyperforms persistence with a logon script via adding to the Registry keyHKCU\Environment\UserInitMprLogonScript.[9]MitigationsIDMitigationDescriptionM1024Restrict Registry PermissionsEnsure proper permissions are set for Registry hives to prevent users from modifying keys for logon scripts that may lead to persistence.DetectionIDData SourceData ComponentDetectsDS0017CommandCommand ExecutionMonitor executed commands and arguments for logon scriptsDS0009ProcessProcess CreationMonitor for newly constructed processes and/or command-lines that execute logon scriptsAnalytic 1 - Boot or Logon Initialization Scripts(source="WinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode="1") OR (source="WinEventLog:Security" EventCode="4688") AND CommandLine="regadd\EnvironmentUserInitMprLogonScript"DS0024Windows RegistryWindows Registry Key CreationMonitor for the creation to Registry keys associated with Windows logon scrips, nameleyHKCU\Environment\UserInitMprLogonScript.Adversaries may schedule software to run whenever a user logs into the system; this is done to establish persistence and sometimes for lateral movement. This trigger is established through the registry key HKEY_CURRENT_USER\EnvironmentUserInitMprLogonScript. This signature looks edits to existing keys or creation of new keys in that path. Users purposefully adding benign scripts to this path will result in false positives; that case is rare, however. There are other ways of running a script at startup or login that are not covered in this signature. Note that this signature overlaps with the Windows Sysinternals Autoruns tool, which would also show changes to this registry path.Analytic 1 - Boot or Logon Initialization Scripts(source="WinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode IN (12, 14, 13)) TargetObject= "\Environment*UserInitMprLogonScript")ReferencesMicrosoft. (2005, January 21). Creating logon scripts. Retrieved April 27, 2016.Hexacorn. (2014, November 14). Beyond good ol’ Run key, Part 18. Retrieved November 15, 2019.Unit 42. (2017, December 15). Unit 42 Playbook Viewer. Retrieved December 20, 2017.Hromcova, Z. (2019, October). AT COMMANDS, TOR-BASED COMMUNICATIONS: MEET ATTOR, A FANTASY CREATURE AND ALSO A SPY PLATFORM. Retrieved May 6, 2020.Gorelik, M. (2018, October 08). Cobalt Group 2.0. Retrieved November 5, 2018.ESET. (2016, October). En Route with Sednit - Part 1: Approaching the Target. Retrieved November 8, 2016.Mercer, W., et al. (2017, October 22). "Cyber Conflict" Decoy Document Used in Real Cyber Conflict. Retrieved November 2, 2018.Dahan, A. et al. (2020, November 2). Back to the Future: Inside the Kimsuky KGH Spyware Suite. Retrieved November 6, 2020.ESET. (2018, November 20). Sednit: What’s going on with Zebrocy?. Retrieved February 12, 2019.×load more resultsContact UsTerms of UsePrivacy PolicyWebsite Changelog© 2015 - 2024, The MITRE Corporation. MITRE ATT&CK and ATT&CK are registered trademarks of The MITRE Corporation.