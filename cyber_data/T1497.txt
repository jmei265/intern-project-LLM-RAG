MatricesEnterpriseMobileICSTacticsEnterpriseMobileICSTechniquesEnterpriseMobileICSDefensesData SourcesMitigationsEnterpriseMobileICSAssetsCTIGroupsSoftwareCampaignsResourcesGet StartedLearn More about ATT&CKATT&CKconATT&CK Data & ToolsFAQEngage with ATT&CKVersion HistoryLegal & BrandingBenefactorsBlogSearchATT&CKcon 5.0 returns October 22-23, 2024 in McLean, VA.Register heretoday!HomeTechniquesEnterpriseVirtualization/Sandbox EvasionVirtualization/Sandbox EvasionSub-techniques (3)IDNameT1497.001System ChecksT1497.002User Activity Based ChecksT1497.003Time Based EvasionAdversaries may employ various means to detect and avoid virtualization and analysis environments. This may include changing behaviors based on the results of checks for the presence of artifacts indicative of a virtual machine environment (VME) or sandbox. If the adversary detects a VME, they may alter their malware to disengage from the victim or conceal the core functions of the implant. They may also search for VME artifacts before dropping secondary or additional payloads. Adversaries may use the information learned fromVirtualization/Sandbox Evasionduring automated discovery to shape follow-on behaviors.[1]Adversaries may use several methods to accomplishVirtualization/Sandbox Evasionsuch as checking for security monitoring tools (e.g., Sysinternals, Wireshark, etc.) or other system artifacts associated with analysis or virtualization. Adversaries may also check for legitimate user activity to help determine if it is in an analysis environment. Additional methods include use of sleep timers or loops within malware code to avoid operating within a temporary sandbox.[2]ID:T1497Sub-techniques:T1497.001,T1497.002,T1497.003ⓘTactics:Defense Evasion,DiscoveryⓘPlatforms:Linux, Windows, macOSⓘDefense Bypassed:Anti-virus, Host forensic analysis, Signature-based detection, Static File AnalysisContributors:Deloitte Threat Library Team; Sunny NeoVersion:1.3Created:17 April 2019Last Modified:18 October 2021Version PermalinkLive VersionProcedure ExamplesIDNameDescriptionS0331Agent TeslaAgent Teslahas the ability to perform anti-sandboxing and anti-virtualization checks.[3]S0534BazarBazarcan attempt to overload sandbox analysis by sending 1550 calls toprintf.[4]S0268BisonalBisonalcan check to determine if the compromised system is running on VMware.[5]S1070Black BastaBlack Bastacan make a random number of calls to thekernel32.beepfunction to hinder log analysis.[6]S1039BumblebeeBumblebeehas the ability to perform anti-virtualization checks.[7]S0484CarberpCarberphas removed various hooks before installing the trojan or bootkit to evade sandbox analysis or other analysis software.[8]S0023CHOPSTICKCHOPSTICKincludes runtime checks to identify an analysis environment and prevent execution on it.[9]S0046CozyCarSome versions ofCozyCarwill check to ensure it is not being executed inside a virtual machine or a known malware analysis sandbox environment. If it detects that it is, it will exit.[10]G0012DarkhotelDarkhotelmalware has employed just-in-time decryption of strings to evade sandbox detection.[11]S0554EgregorEgregorhas used multiple anti-analysis and anti-sandbox techniques to prevent automated analysis by sandboxes.[12][13]S0666GelsemiumGelsemiumcan use junk code to generate random activity to obscure malware behavior.[14]S0499HancitorHancitorhas used a macro to check that an ActiveDocument shape object in the lure message is present. If this object is not found, the macro will exit without downloading additional payloads.[15]S1020KevinKevincan sleep for a time interval between C2 communication attempts.[16]S0455MetamorfoMetamorfohas embedded a "vmdetect.exe" executable to identify virtual machines at the beginning of execution.[17]C0005Operation SpalaxDuringOperation Spalax, the threat actors used droppers that would run anti-analysis checks before executing malware on a compromised host.[18]S0147PteranodonPteranodonhas the ability to use anti-detection functions to identify sandbox environments.[19]S0148RTMRTMcan detect if it is running within a sandbox or other virtualized analysis environment.[20]S1030SquirrelwaffleSquirrelwafflehas contained a hardcoded list of IP addresses to block that belong to sandboxes and analysis platforms.[21][22]S0380StoneDrillStoneDrillhas used several anti-emulation techniques to prevent automated analysis by emulators or sandboxes.[23]MitigationsThis type of attack technique cannot be easily mitigated with preventive controls since
                                    it is based on the abuse of system features.DetectionIDData SourceData ComponentDetectsDS0017CommandCommand ExecutionMonitor executed commands and arguments that may employ various means to detect and avoid virtualization and analysis environments. Detecting actions related to virtualization and sandbox identification may be difficult depending on the adversary's implementation and monitoring required.DS0009ProcessOS API ExecutionMonitor for API calls that may employ various means to detect and avoid virtualization and analysis environments. Detecting actions related to virtualization and sandbox identification may be difficult depending on the adversary's implementation and monitoring required.Process CreationVirtualization, sandbox, user activity, and related discovery techniques will likely occur in the first steps of an operation but may also occur throughout as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities, such as lateral movement, based on the information obtained. Detecting actions related to virtualization and sandbox identification may be difficult depending on the adversary's implementation and monitoring required. Monitoring for suspicious processes being spawned that gather a variety of system information or perform other forms of Discovery, especially in a short period of time, may aid in detection.ReferencesTorello, A. & Guibernau, F. (n.d.). Environment Awareness. Retrieved May 18, 2021.Falcone, R., Wartell, R.. (2015, July 27). UPS: Observations on CVE-2015-3113, Prior Zero-Days and the Pirpi Payload. Retrieved April 23, 2019.Jazi, H. (2020, April 16). New AgentTesla variant steals WiFi credentials. Retrieved May 19, 2020.Cybereason Nocturnus. (2020, July 16). A BAZAR OF TRICKS: FOLLOWING TEAM9’S DEVELOPMENT CYCLES. Retrieved November 18, 2020.Mercer, W., et al. (2020, March 5). Bisonal: 10 years of play. Retrieved January 26, 2022.Check Point. (2022, October 20). BLACK BASTA AND THE UNNOTICED DELIVERY. Retrieved March 8, 2023.Merriman, K. and Trouerbach, P. (2022, April 28). This isn't Optimus Prime's Bumblebee but it's Still Transforming. Retrieved August 22, 2022.Matrosov, A., Rodionov, E., Volkov, D., Harley, D. (2012, March 2). Win32/Carberp When You’re in a Black Hole, Stop Digging. Retrieved July 15, 2020.FireEye. (2015). APT28: A WINDOW INTO RUSSIA’S CYBER ESPIONAGE OPERATIONS?. Retrieved August 19, 2015.F-Secure Labs. (2015, April 22). CozyDuke: Malware Analysis. Retrieved December 10, 2015.Arunpreet Singh, Clemens Kolbitsch. (2015, November 5). Defeating Darkhotel Just-In-Time Decryption. Retrieved April 15, 2021.Cybleinc. (2020, October 31). Egregor Ransomware – A Deep Dive Into Its Activities and Techniques. Retrieved December 29, 2020.NHS Digital. (2020, November 26). Egregor Ransomware The RaaS successor to Maze. Retrieved December 29, 2020.Dupuy, T. and Faou, M. (2021, June). Gelsemium. Retrieved November 30, 2021.Anubhav, A., Jallepalli, D. (2016, September 23). Hancitor (AKA Chanitor) observed using multiple attack approaches. Retrieved August 13, 2020.Kayal, A. et al. (2021, October). LYCEUM REBORN: COUNTERINTELLIGENCE IN THE MIDDLE EAST. Retrieved June 14, 2022.Erlich, C. (2020, April 3). The Avast Abuser: Metamorfo Banking Malware Hides By Abusing Avast Executable. Retrieved May 26, 2020.M. Porolli. (2021, January 21). Operation Spalax: Targeted malware attacks in Colombia. Retrieved September 16, 2022.Unit 42. (2022, February 3). Russia’s Gamaredon aka Primitive Bear APT Group Actively Targeting Ukraine. Retrieved February 21, 2022.Duncan, B., Harbison, M. (2019, January 23). Russian Language Malspam Pushing Redaman Banking Malware. Retrieved June 16, 2020.Kumar, A., Stone-Gross, Brett. (2021, September 28). Squirrelwaffle: New Loader Delivering Cobalt Strike. Retrieved August 9, 2022.Palazolo, G. (2021, October 7). SquirrelWaffle: New Malware Loader Delivering Cobalt Strike and QakBot. Retrieved August 9, 2022.Kaspersky Lab. (2017, March 7). From Shamoon to StoneDrill: Wipers attacking Saudi organizations and beyond. Retrieved March 14, 2019.×load more resultsContact UsTerms of UsePrivacy PolicyWebsite Changelog© 2015 - 2024, The MITRE Corporation. MITRE ATT&CK and ATT&CK are registered trademarks of The MITRE Corporation.