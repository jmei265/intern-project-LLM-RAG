MatricesEnterpriseMobileICSTacticsEnterpriseMobileICSTechniquesEnterpriseMobileICSDefensesData SourcesMitigationsEnterpriseMobileICSAssetsCTIGroupsSoftwareCampaignsResourcesGet StartedLearn More about ATT&CKATT&CKconATT&CK Data & ToolsFAQEngage with ATT&CKVersion HistoryLegal & BrandingBenefactorsBlogSearchATT&CKcon 5.0 returns October 22-23, 2024 in McLean, VA.Register heretoday!HomeTechniquesEnterpriseBITS JobsBITS JobsAdversaries may abuse BITS jobs to persistently execute code and perform various background tasks. Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed throughComponent Object Model(COM).[1][2]BITS is commonly used by updaters, messengers, and other applications preferred to operate in the background (using available idle bandwidth) without interrupting other networked applications. File transfer tasks are implemented as BITS jobs, which contain a queue of one or more file operations.The interface to create and manage BITS jobs is accessible throughPowerShelland theBITSAdmintool.[2][3]Adversaries may abuse BITS to download (e.g.Ingress Tool Transfer), execute, and even clean up after running malicious code (e.g.Indicator Removal). BITS tasks are self-contained in the BITS job database, without new files or registry modifications, and often permitted by host firewalls.[4][5][6]BITS enabled execution may also enable persistence by creating long-standing jobs (the default maximum lifetime is 90 days and extendable) or invoking an arbitrary program when a job completes or errors (including after system reboots).[7][4]BITS upload functionalities can also be used to performExfiltration Over Alternative Protocol.[4]ID:T1197Sub-techniques:No sub-techniquesⓘTactics:Defense Evasion,PersistenceⓘPlatforms:WindowsⓘDefense Bypassed:Firewall, Host forensic analysisContributors:Brent Murphy, Elastic; David French, Elastic; Red Canary; Ricardo DiasVersion:1.4Created:18 April 2018Last Modified:21 April 2023Version PermalinkLive VersionProcedure ExamplesIDNameDescriptionG0087APT39APT39has used the BITS protocol to exfiltrate stolen data from a compromised host.[8]G0096APT41APT41usedBITSAdminto download and install payloads.[9][10]S0534BazarBazarhas been downloaded via Windows BITS functionality.[11]S0190BITSAdminBITSAdmincan be used to createBITS Jobsto launch a malicious process.[12]S0154Cobalt StrikeCobalt Strikecan download a hosted "beacon" payload usingBITSAdmin.[13][14][15]S0554EgregorEgregorhas used BITSadmin to download and execute malicious DLLs.[16]S0201JPINAJPINvariant downloads the backdoor payload via the BITS service.[17]G0065LeviathanLeviathanhas usedBITSAdminto download additional tools.[18]S0652MarkiRATMarkiRATcan use BITS Utility to connect with the C2 server.[19]G0040PatchworkPatchworkhas used BITS jobs to download malicious payloads.[20]S0654ProLockProLockcan use BITS jobs to download its malicious payload.[21]S0333UBoatRATUBoatRATtakes advantage of the /SetNotifyCmdLine option inBITSAdminto ensure it stays running on a system to maintain persistence.[7]G0102Wizard SpiderWizard Spiderhas used batch scripts that utilizes WMIC to execute aBITSAdmintransfer of a ransomware payload to each compromised machine.[22]MitigationsIDMitigationDescriptionM1037Filter Network TrafficModify network and/or host firewall rules, as well as other network controls, to only allow legitimate BITS traffic.M1028Operating System ConfigurationConsider reducing the default BITS job lifetime in Group Policy or by editing theJobInactivityTimeoutandMaxDownloadTimeRegistry values inHKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\BITS.[2]M1018User Account ManagementConsider limiting access to the BITS interface to specific users or groups.[6]DetectionIDData SourceData ComponentDetectsDS0017CommandCommand ExecutionMonitor executed commands and arguments from the BITSAdmin tool (especially the ‘Transfer’, 'Create', 'AddFile', 'SetNotifyFlags', 'SetNotifyCmdLine', 'SetMinRetryDelay', 'SetCustomHeaders', and 'Resume' command options)[2]Admin logs, PowerShell logs, and the Windows Event log for BITS activity.[23]Also consider investigating more detailed information about jobs by parsing the BITS job database.[4]DS0029Network TrafficNetwork Connection CreationMonitor for newly constructed network activity generated by BITS. BITS jobs use HTTP(S) and SMB for remote connections and are tethered to the creating user and will only function when that user is logged on (this rule applies even if a user attaches the job to a service account).DS0009ProcessProcess CreationMonitor for newly constructed BITS tasks to enumerate using the BITSAdmin tool (bitsadmin /list /allusers /verbose).Note: Event IDs are for Sysmon (Event ID 1 - process create) and Windows Security Log (Event ID 4688 - a new process has been created). Analytic 1 is oriented around looking for the creation of Microsoft Background Intelligent Transfer Service utility (bitsadmin.exe) processes that schedule a BITS job to persist on an endpoint. The analytic identifies the command-line parameters used to create, resume or add a file to a BITS job; these are typically seen combined in a single command-line or executed in sequence.Analytic 2 identifies Microsoft Background Intelligent Transfer Service utilitybitsadmin.exeusing thetransferparameter to download a remote object. In addition, look fordownloadoruploadon the command-line, the switches are not required to perform a transfer. Capture any files downloaded. Review the reputation of the IP or domain used. Typically once executed, a follow on command will be used to execute the dropped file. Network connection or file modification events related will not spawn or create frombitsadmin.exe, but the artifacts will appear in a parallel process ofsvchost.exewith a command-line similar tosvchost.exe -k netsvcs -s BITS. It’s important to review all parallel and child processes to capture any behaviors and artifacts. In some suspicious and malicious instances, BITS jobs will be created. You can usebitsadmin /list /verboseto list out the jobs during investigation.Analytic 1 - BITS Job Persistence(source="WinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode="1") OR (source="WinEventLog:Security" EventCode="4688") Image="C:\Windows\System32\bitsadmin.exe" AND   (CommandLine= "create" OR   CommandLine= "addfile" OR    CommandLine= "setnotifyflags" OR   CommandLine= "setnotifycmdline" OR   CommandLine= "setminretrydelay" OR    CommandLine= "setcustomheaders" OR   CommandLine= "resume")Analytic 2 - BITSAdmin Download File(source="WinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode="1") OR (source="WinEventLog:Security" EventCode="4688") Image="C:\Windows\System32\bitsadmin.exe" AND CommandLine=transferDS0019ServiceService MetadataBITS runs as a service and its status can be checked with the Sc query utility (sc query bits).[24]ReferencesMicrosoft. (n.d.). Component Object Model (COM). Retrieved November 22, 2017.Microsoft. (n.d.). Background Intelligent Transfer Service. Retrieved January 12, 2018.Microsoft. (n.d.). BITSAdmin Tool. Retrieved January 12, 2018.Counter Threat Unit Research Team. (2016, June 6). Malware Lingers with BITS. Retrieved January 12, 2018.Mondok, M. (2007, May 11). Malware piggybacks on Windows’ Background Intelligent Transfer Service. Retrieved January 12, 2018.Florio, E. (2007, May 9). Malware Update with Windows Update. Retrieved January 12, 2018.Hayashi, K. (2017, November 28). UBoatRAT Navigates East Asia. Retrieved January 12, 2018.FBI. (2020, September 17). Indicators of Compromise Associated with Rana Intelligence Computing, also known as Advanced Persistent Threat 39, Chafer, Cadelspy, Remexi, and ITG07. Retrieved December 10, 2020.Glyer, C, et al. (2020, March). This Is Not a Test: APT41 Initiates Global Intrusion Campaign Using Multiple Exploits. Retrieved April 28, 2020.Crowdstrike. (2020, March 2). 2020 Global Threat Report. Retrieved December 11, 2020.Pantazopoulos, N. (2020, June 2). In-depth analysis of the new Team9 malware family. Retrieved December 1, 2020.Horejsi, J., et al. (2018, March 14). Tropic Trooper’s New Strategy. Retrieved November 9, 2018.Strategic Cyber, LLC. (n.d.). Scripted Web Delivery. Retrieved January 23, 2018.Mavis, N. (2020, September 21). The Art and Science of Detecting Cobalt Strike. Retrieved April 6, 2021.Strategic Cyber LLC. (2020, November 5). Cobalt Strike: Advanced Threat Tactics for Penetration Testers. Retrieved April 13, 2021.Bichet, J. (2020, November 12). Egregor – Prolock: Fraternal Twins ?. Retrieved January 6, 2021.Windows Defender Advanced Threat Hunting Team. (2016, April 29). PLATINUM: Targeted attacks in South and Southeast Asia. Retrieved February 15, 2018.FireEye. (2018, March 16). Suspected Chinese Cyber Espionage Group (TEMP.Periscope) Targeting U.S. Engineering and Maritime Industries. Retrieved April 11, 2018.GReAT. (2021, June 16). Ferocious Kitten: 6 Years of Covert Surveillance in Iran. Retrieved September 22, 2021.Hinchliffe, A. and Falcone, R. (2020, May 11). Updated BackConfig Malware Targeting Government and Military Organizations in South Asia. Retrieved June 17, 2020.Group IB. (2020, September). LOCK LIKE  A PRO. Retrieved September 27, 2021.Shilko, J., et al. (2021, October 7). FIN12: The Prolific Ransomware Intrusion Threat Actor That Has Aggressively Pursued Healthcare Targets. Retrieved June 15, 2023.French, D., Murphy, B. (2020, March 24). Adversary tradecraft 101: Hunting for persistence using Elastic Security (Part 1). Retrieved December 21, 2020.Microsoft. (2011, July 19). Issues with BITS. Retrieved January 12, 2018.×load more resultsContact UsTerms of UsePrivacy PolicyWebsite Changelog© 2015 - 2024, The MITRE Corporation. MITRE ATT&CK and ATT&CK are registered trademarks of The MITRE Corporation.