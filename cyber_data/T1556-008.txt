MatricesEnterpriseMobileICSTacticsEnterpriseMobileICSTechniquesEnterpriseMobileICSDefensesData SourcesMitigationsEnterpriseMobileICSAssetsCTIGroupsSoftwareCampaignsResourcesGet StartedLearn More about ATT&CKATT&CKconATT&CK Data & ToolsFAQEngage with ATT&CKVersion HistoryLegal & BrandingBenefactorsBlogSearchATT&CKcon 5.0 returns October 22-23, 2024 in McLean, VA.Register heretoday!HomeTechniquesEnterpriseModify Authentication ProcessNetwork Provider DLLModify Authentication Process:Network Provider DLLOther sub-techniques of Modify Authentication Process (9)IDNameT1556.001Domain Controller AuthenticationT1556.002Password Filter DLLT1556.003Pluggable Authentication ModulesT1556.004Network Device AuthenticationT1556.005Reversible EncryptionT1556.006Multi-Factor AuthenticationT1556.007Hybrid IdentityT1556.008Network Provider DLLT1556.009Conditional Access PoliciesAdversaries may register malicious network provider dynamic link libraries (DLLs) to capture cleartext user credentials during the authentication process. Network provider DLLs allow Windows to interface with specific network protocols and can also support add-on credential management functions.[1]During the logon process, Winlogon (the interactive logon module) sends credentials to the localmpnotify.exeprocess via RPC. Thempnotify.exeprocess then shares the credentials in cleartext with registered credential managers when notifying that a logon event is happening.[2][3][4]Adversaries can configure a malicious network provider DLL to receive credentials frommpnotify.exe.[5]Once installed as a credential manager (via the Registry), a malicious DLL can receive and save credentials each time a user logs onto a Windows workstation or domain via theNPLogonNotify()function.[4]Adversaries may target planting malicious network provider DLLs on systems known to have increased logon activity and/or administrator logon activity, such as servers and domain controllers.[2]ID:T1556.008Sub-technique of:T1556ⓘTactics:Credential Access,Defense Evasion,PersistenceⓘPlatforms:WindowsContributors:CrowdStrike Falcon OverWatch; Jai MintonVersion:1.0Created:30 March 2023Last Modified:04 May 2023Version PermalinkLive VersionMitigationsIDMitigationDescriptionM1047AuditPeriodically review for new and unknown network provider DLLs within the Registry (HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\<NetworkProviderName>\NetworkProvider\ProviderPath).Ensure only valid network provider DLLs are registered. The name of these can be found in the Registry key atHKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\NetworkProvider\Order, and have corresponding service subkey pointing to a DLL atHKEY_LOCAL_MACHINE\SYSTEM\CurrentC ontrolSet\Services\<NetworkProviderName>\NetworkProvider.M1028Operating System ConfigurationStarting in Windows 11 22H2, theEnableMPRNotificationspolicy can be disabled through Group Policy or through a configuration service provider to prevent Winlogon from sending credentials to network providers.[6]M1024Restrict Registry PermissionsRestrict Registry permissions to disallow the modification of sensitive Registry keys such asHKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\NetworkProvider\Order.DetectionIDData SourceData ComponentDetectsDS0022FileFile CreationMonitor for newly created files that may be used to register malicious network provider dynamic link libraries (DLLs).DS0009ProcessOS API ExecutionMonitor for abnormal API calls toNPLogonNotify().[4]DS0024Windows RegistryWindows Registry Key CreationMonitor for the addition of network provider Registry keys (e.g.,HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\<NetworkProviderName>\NetworkProvider).Windows Registry Key ModificationMonitor for changes to Registry entries for network providers (e.g.,HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\NetworkProvider\Order) and correlate then investigate the DLL files these values reference.ReferencesMicrosoft. (2021, January 7). Network Provider API. Retrieved March 30, 2023.Dray Agha. (2022, August 16). Cleartext Shenanigans: Gifting User Passwords to Adversaries With NPPSPY. Retrieved March 30, 2023.Grzegorz Tworek. (2021, December 14). How winlogon.exe shares the cleartext password with custom DLLs. Retrieved March 30, 2023.Microsoft. (2021, October 21). NPLogonNotify function (npapi.h). Retrieved March 30, 2023.Grzegorz Tworek. (2021, December 15). NPPSpy. Retrieved March 30, 2023.Microsoft. (2023, January 26). Policy CSP - WindowsLogon. Retrieved March 30, 2023.×load more resultsContact UsTerms of UsePrivacy PolicyWebsite Changelog© 2015 - 2024, The MITRE Corporation. MITRE ATT&CK and ATT&CK are registered trademarks of The MITRE Corporation.