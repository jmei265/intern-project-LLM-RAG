MatricesEnterpriseMobileICSTacticsEnterpriseMobileICSTechniquesEnterpriseMobileICSDefensesData SourcesMitigationsEnterpriseMobileICSAssetsCTIGroupsSoftwareCampaignsResourcesGet StartedLearn More about ATT&CKATT&CKconATT&CK Data & ToolsFAQEngage with ATT&CKVersion HistoryLegal & BrandingBenefactorsBlogSearchATT&CKcon 5.0 returns October 22-23, 2024 in McLean, VA.Register heretoday!HomeTechniquesEnterpriseOS Credential DumpingCached Domain CredentialsOS Credential Dumping:Cached Domain CredentialsOther sub-techniques of OS Credential Dumping (8)IDNameT1003.001LSASS MemoryT1003.002Security Account ManagerT1003.003NTDST1003.004LSA SecretsT1003.005Cached Domain CredentialsT1003.006DCSyncT1003.007Proc FilesystemT1003.008/etc/passwd and /etc/shadowAdversaries may attempt to access cached domain credentials used to allow authentication to occur in the event a domain controller is unavailable.[1]On Windows Vista and newer, the hash format is DCC2 (Domain Cached Credentials version 2) hash, also known as MS-Cache v2 hash.[2]The number of default cached credentials varies and can be altered per system. This hash does not allow pass-the-hash style attacks, and instead requiresPassword Crackingto recover the plaintext password.[3]On Linux systems, Active Directory credentials can be accessed through caches maintained by software like System Security Services Daemon (SSSD) or Quest Authentication Services (formerly VAS). Cached credential hashes are typically located at/var/lib/sss/db/cache.[domain].ldbfor SSSD or/var/opt/quest/vas/authcache/vas_auth.vdbfor Quest. Adversaries can use utilities, such astdbdump, on these database files to dump the cached hashes and usePassword Crackingto obtain the plaintext password.[4]With SYSTEM or sudo access, the tools/utilities such asMimikatz,Reg, and secretsdump.py for Windows or Linikatz for Linux can be used to extract the cached credentials.[4]Note: Cached credentials for Windows Vista are derived using PBKDF2.[2]ID:T1003.005Sub-technique of:T1003ⓘTactic:Credential AccessⓘPlatforms:Linux, WindowsContributors:Ed Williams, Trustwave, SpiderLabs; Tim (Wadhwa-)Brown; Yves YonanVersion:1.1Created:21 February 2020Last Modified:18 April 2024Version PermalinkLive VersionProcedure ExamplesIDNameDescriptionG0064APT33APT33has used a variety of publicly available tools likeLaZagneto gather credentials.[5][6]S0119CachedumpCachedumpcan extract cached password hashes from cache entry information.[7]S0349LaZagneLaZagnecan perform credential dumping from MSCache to obtain account and password information.[8]G0077LeafminerLeafminerused several tools for retrieving login and password information, including LaZagne.[9]G0069MuddyWaterMuddyWaterhas performed credential dumping withLaZagne.[10][11]G0049OilRigOilRighas used credential dumping tools such asLaZagneto steal credentials to accounts logged into the compromised system and to Outlook Web Access.[12][13][14][15]S0439OkrumOkrumwas seen using modified Quarks PwDump to perform credential dumping.[16]S0192PupyPupycan use Lazagne for harvesting credentials.[17]MitigationsIDMitigationDescriptionM1015Active Directory ConfigurationConsider adding users to the "Protected Users" Active Directory security group. This can help limit the caching of users' plaintext credentials.[18]M1028Operating System ConfigurationConsider limiting the number of cached credentials (HKLM\SOFTWARE\Microsoft\Windows NT\Current Version\Winlogon\cachedlogonscountvalue)[19]M1027Password PoliciesEnsure that local administrator accounts have complex, unique passwords across all systems on the network.M1026Privileged Account ManagementDo not put user or admin domain accounts in the local administrator groups across systems unless they are tightly controlled, as this is often equivalent to having a local administrator account with the same password on all systems. Follow best practices for design and administration of an enterprise network to limit privileged account use across administrative tiers.M1017User TrainingLimit credential overlap across accounts and systems by training users and administrators not to use the same password for multiple accounts.DetectionIDData SourceData ComponentDetectsDS0017CommandCommand ExecutionMonitor executed commands and arguments that may attempt to access cached domain credentials used to allow authentication to occur in the event a domain controller is unavailable.[1]. Remote access tools may contain built-in features or incorporate existing tools like Mimikatz. PowerShell scripts also exist that contain credential dumping functionality, such as PowerSploit's Invoke-Mimikatz module,[20]which may require additional logging features to be configured in the operating system to collect necessary information for analysis.Detection of compromisedValid Accountsin-use by adversaries may help as well.ReferencesMicrosoft. (2016, August 21). Cached and Stored Credentials Technical Overview. Retrieved February 21, 2020.Eli Collins. (2016, November 25). Windows' Domain Cached Credentials v2. Retrieved February 21, 2020.Mantvydas Baranauskas. (2019, November 16). Dumping and Cracking mscash - Cached Domain Credentials. Retrieved February 21, 2020.Tim Wadhwa-Brown. (2018, November). Where 2 worlds collide Bringing Mimikatz et al to UNIX. Retrieved October 13, 2021.Security Response attack Investigation Team. (2019, March 27). Elfin: Relentless Espionage Group Targets Multiple Organizations in Saudi Arabia and U.S.. Retrieved April 10, 2019.Ackerman, G., et al. (2018, December 21). OVERRULED: Containing a Potentially Destructive Adversary. Retrieved January 17, 2019.Mandiant. (n.d.). APT1 Exposing One of China’s Cyber Espionage Units. Retrieved July 18, 2016.Zanni, A. (n.d.). The LaZagne Project !!!. Retrieved December 14, 2018.Symantec Security Response. (2018, July 25). Leafminer: New Espionage Campaigns Targeting Middle Eastern Regions. Retrieved August 28, 2018.Lancaster, T.. (2017, November 14). Muddying the Water: Targeted Attacks in the Middle East. Retrieved March 15, 2018.Symantec DeepSight Adversary Intelligence Team. (2018, December 10). Seedworm: Group Compromises Government Agencies, Oil & Gas, NGOs, Telecoms, and IT Firms. Retrieved December 14, 2018.Unit42. (2016, May 1). Evasive Serpens Unit 42 Playbook Viewer. Retrieved February 6, 2023.Davis, S. and Caban, D. (2017, December 19). APT34 - New Targeted Attack in the Middle East. Retrieved December 20, 2017.Mandiant. (2018). Mandiant M-Trends 2018. Retrieved July 9, 2018.Bromiley, M., et al.. (2019, July 18). Hard Pass: Declining APT34’s Invite to Join Their Professional Network. Retrieved August 26, 2019.Hromcova, Z. (2019, July). OKRUM AND KETRICAN: AN OVERVIEW OF RECENT KE3CHANG GROUP ACTIVITY. Retrieved May 6, 2020.Nicolas Verdier. (n.d.). Retrieved January 29, 2018.Microsoft. (2016, October 12). Protected Users Security Group. Retrieved May 29, 2020.Chad Tilbury. (2017, August 8). 1Windows Credentials: Attack, Mitigation, Defense. Retrieved February 21, 2020.PowerSploit. (n.d.). Retrieved December 4, 2014.×load more resultsContact UsTerms of UsePrivacy PolicyWebsite Changelog© 2015 - 2024, The MITRE Corporation. MITRE ATT&CK and ATT&CK are registered trademarks of The MITRE Corporation.