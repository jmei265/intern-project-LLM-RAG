MatricesEnterpriseMobileICSTacticsEnterpriseMobileICSTechniquesEnterpriseMobileICSDefensesData SourcesMitigationsEnterpriseMobileICSAssetsCTIGroupsSoftwareCampaignsResourcesGet StartedLearn More about ATT&CKATT&CKconATT&CK Data & ToolsFAQEngage with ATT&CKVersion HistoryLegal & BrandingBenefactorsBlogSearchATT&CKcon 5.0 returns October 22-23, 2024 in McLean, VA.Register heretoday!HomeTechniquesEnterpriseRemote ServicesSMB/Windows Admin SharesRemote Services:SMB/Windows Admin SharesOther sub-techniques of Remote Services (8)IDNameT1021.001Remote Desktop ProtocolT1021.002SMB/Windows Admin SharesT1021.003Distributed Component Object ModelT1021.004SSHT1021.005VNCT1021.006Windows Remote ManagementT1021.007Cloud ServicesT1021.008Direct Cloud VM ConnectionsAdversaries may useValid Accountsto interact with a remote network share using Server Message Block (SMB). The adversary may then perform actions as the logged-on user.SMB is a file, printer, and serial port sharing protocol for Windows machines on the same network or domain. Adversaries may use SMB to interact with file shares, allowing them to move laterally throughout a network. Linux and macOS implementations of SMB typically use Samba.Windows systems have hidden network shares that are accessible only to administrators and provide the ability for remote file copy and other administrative functions. Example network shares includeC$,ADMIN$, andIPC$. Adversaries may use this technique in conjunction with administrator-levelValid Accountsto remotely access a networked system over SMB,[1]to interact with systems using remote procedure calls (RPCs),[2]transfer files, and run transferred binaries through remote Execution. Example execution techniques that rely on authenticated sessions over SMB/RPC areScheduled Task/Job,Service Execution, andWindows Management Instrumentation. Adversaries can also use NTLM hashes to access administrator shares on systems withPass the Hashand certain configuration and patch levels.[3]ID:T1021.002Sub-technique of:T1021ⓘTactic:Lateral MovementⓘPlatforms:WindowsⓘSystem Requirements:SMB enabled; Host/network firewalls not blocking SMB ports between source and destination; Use of domain account in administrator group on remote system or default system admin account.Version:1.2Created:11 February 2020Last Modified:28 July 2023Version PermalinkLive VersionProcedure ExamplesIDNameDescriptionC00252016 Ukraine Electric Power AttackDuring the2016 Ukraine Electric Power Attack,Sandworm Teamutilizednet useto connect to network shares.[4]S0504AnchorAnchorcan support windows execution via SMB shares.[5]G0007APT28APT28has mapped network drives usingNetand administrator credentials.[6]G0022APT3APT3will copy files over to Windows Admin Shares (like ADMIN$) as part of lateral movement.[7]G0050APT32APT32usedNetto use Windows' hidden network shares to copy their tools to remote machines for execution.[8]G0087APT39APT39has used SMB for lateral movement.[9]G0096APT41APT41has transferred implant files using Windows Admin Shares.[10]S0089BlackEnergyBlackEnergyhas run a plug-in on a victim to spread through the local network by usingPsExecand accessing admin shares.[11]G0108Blue MockingbirdBlue Mockingbirdhas used Windows Explorer to manually copy malicious files to remote hosts over SMB.[12]S1063Brute Ratel C4Brute Ratel C4has the ability to use SMB to pivot in compromised networks.[13][14][15]G0114ChimeraChimerahas used Windows admin shares to move laterally.[16][17]G1021Cinnamon TempestCinnamon Tempesthas used SMBexec for lateral movement.[18]S0154Cobalt StrikeCobalt Strikecan use Window admin shares (C$ and ADMIN$) for lateral movement.[19][20]S0608ConfickerConfickervariants spread through NetBIOS share propagation.[21]S0575ContiContican spread via SMB and encrypts files on different hosts, potentially compromising an entire network.[22][23]C0029Cutting EdgeDuringCutting Edge, threat actors moved laterally using compromised credentials to connect to internal Windows systems with SMB.[24]G0009Deep PandaDeep Pandauses net.exe to connect to network shares usingnet usecommands with compromised credentials.[25]S0659DiavolDiavolcan spread throughout a network via SMB prior to encryption.[26]S0038DuquAdversaries can instructDuquto spread laterally by copying itself to shares it has enumerated and for which it has obtained legitimate credentials (via keylogging or other means). The remote host is then infected by using the compromised credentials to schedule a task on remote machines that executes the malware.[27]S0367EmotetEmotethas leveraged the Admin$, C$, and IPC$ shares for lateral movement.[28][29]G1016FIN13FIN13has leveraged SMB to move laterally within a compromised network via application servers and SQL servers.[30]G0061FIN8FIN8has attempted to map to C$ on enumerated hosts to test the scope of their current credentials/context.FIN8has also used smbexec from theImpacketsuite for lateral movement.[31][32]G0117Fox KittenFox Kittenhas used valid accounts to access SMB shares.[33]S0698HermeticWizardHermeticWizardcan use a list of hardcoded credentials to to authenticate via NTLMSSP to the SMB shares on remote systems.[34]G0004Ke3changKe3changactors have been known to copy files to the network shares of other computers to move laterally.[35][36]S0236KwampirsKwampirscopies itself over network shares to move laterally on a victim network.[37]G0032Lazarus GroupLazarus Groupmalware SierraAlfa accesses theADMIN$share via SMB to conduct lateral movement.[38][39]S0532LuciferLucifercan infect victims by brute forcing SMB.[40]G1009Moses StaffMoses Staffhas used batch scripts that can enable SMB on a compromised host.[41]S0039NetLateral movement can be done withNetthroughnet usecommands to connect to the on remote systems.[42]S0056Net CrawlerNet Crawleruses Windows admin shares to establish authenticated sessions to remote systems over SMB as part of lateral movement.[43]S0368NotPetyaNotPetyacan usePsExec, which interacts with theADMIN$network share to execute commands on remote systems.[44][45][46]S0365Olympic DestroyerOlympic DestroyerusesPsExecto interact with theADMIN$network share to execute commands on remote systems.[47][46]C0014Operation WocaoDuringOperation Wocao, threat actors usedImpacket's smbexec.py as well as accessing the C$ and IPC$ shares to move laterally.[48]G0071OrangewormOrangewormhas copied its backdoor across open network shares, including ADMIN$, C$WINDOWS, D$WINDOWS, and E$WINDOWS.[37]S0029PsExecPsExec, a tool that has been used by adversaries, writes programs to theADMIN$network share to execute commands on remote systems.[46]S0019ReginTheReginmalware platform can use Windows admin shares to move laterally.[49]S1073RoyalRoyalcan use SMB to connect to move laterally.[50]S0446RyukRyukhas used the C$ network share for lateral movement.[51]G0034Sandworm TeamSandworm Teamhas copied payloads to theADMIN$share of remote systems and runnet useto connect to network shares.[4][52]S0140ShamoonShamoonaccesses network share(s), enables share access to the target device, copies an executable payload to the target system, and uses aScheduled Task/Jobto execute the malware.[53]C0024SolarWinds CompromiseDuring theSolarWinds Compromise,APT29used administrative accounts to connect over SMB to targeted users.[54]S0603StuxnetStuxnetpropagates to available network shares.[55]G0028Threat Group-1314Threat Group-1314actors mapped network drives usingnet use.[56]G1022ToddyCatToddyCathas used locally mounted network shares for lateral movement through targated environments.[57]G0010TurlaTurlausednet usecommands to connect to lateral systems within a network.[58]G0102Wizard SpiderWizard Spiderhas used SMB to drop Cobalt Strike Beacon on a domain controller for lateral movement.[59][60]S0672ZoxZoxhas the ability to use SMB for communication.[61]S0350zwShellzwShellhas been copied over network shares to move laterally.[62]MitigationsIDMitigationDescriptionM1037Filter Network TrafficConsider using the host firewall to restrict file sharing communications such as SMB.[63]M1035Limit Access to Resource Over NetworkConsider disabling Windows administrative shares.M1027Password PoliciesDo not reuse local administrator account passwords across systems. Ensure password complexity and uniqueness such that the passwords cannot be cracked or guessed.M1026Privileged Account ManagementDeny remote use of local admin credentials to log into systems. Do not allow domain user accounts to be in the local Administrators group multiple systems.DetectionIDData SourceData ComponentDetectsDS0017CommandCommand ExecutionMonitor executed commands and arguments that connect to remote shares, such asNet, on the command-line interface and Discovery techniques that could be used to find remotely accessible systems.[64]Note: Event ID 4104 (from the Microsoft-Windows-Powershell/Operational log) captures Powershell script blocks, which can be analyzed and used to detect on potential connections and writing to remote shares.DS0028Logon SessionLogon Session CreationMonitor for logon behavior (ex: EID 4624 Logon Type 3) usingValid Accountsto interact with a remote network share using Server Message Block (SMB). The adversary may then perform actions as the logged-on user. Ensure that proper logging of accounts used to log into systems is turned on and centrally collected. Windows logging is able to collect success/failure for accounts that may be used to move laterally and can be collected using tools such as Windows Event Forwarding.[65][66]DS0033Network ShareNetwork Share AccessMonitor interactions with network shares, such as reads or file transfers, using Server Message Block (SMB).DS0029Network TrafficNetwork Connection CreationMonitor for newly constructed network connections (typically over ports 139 or 445), especially those that are sent or received by abnormal or untrusted hosts. Correlate these network connections with remote login events and associated SMB-related activity such as file transfers and remote process execution.Note: Event ID is for Zeek but can also be implemented in other Network Analysis Frameworks by parsing & decoding captured SMB2 network traffic. Preference would be to detect smb2_write_response event (instead of smb2_write_request), because it would confirm the file was actually written to the remote destination. Unfortunately, Bro/Zeek does not have an event for that SMB message-type yet. From a network traffic capture standpoint, it’s important to capture the right traffic for this type of detection to function (e.g., all endpoint to endpoint if possible or workstation to server and workstation to workstation). As such, it is helpful to have a centralized server area where it is possible to monitor communications between servers and endpoints.Analytic 1 and 2 are very similar, with the key difference being that Implementation 2 is intended to capture multiple attempts at lateral movement originating from the same host within a short time period (5 minutes).smb2_write_request, smb1_write_andx_response is indication of an SMB file write to a Windows Admin File Share: ADMIN$ or C$smb2_tree_connect_request, smb1_tree_connect_andx_request is observed originating from the same host, regardless of write-attempts and regardless of whether or not any connection is successful —just connection attempts— within a specified period of time (REPEATS 5 TIMES WITHIN 5 MINUTES FROM SAME src_ip).From a network traffic capture standpoint, it’s important to capture the right traffic for this type of detection to function (e.g., all endpoint to endpoint if possible or workstation to server and workstation to workstation). As such, it is helpful to have a centralized server area where it is possible to monitor communications between servers and endpoints.The Service Control Manager (SCM) can be used to copy a file to the ADMIN$ share and execute it as a service. This can be detected by looking for incoming RPC network connections to the Service Control Manager, followed by services.exe spawning a child process.Analytic 1 - Basicsource="*Zeek:SMB_Files" EventCode IN ("smb2_write_request", "smb1_write_andx_response", "smb2_tree_connect_request", "smb1_tree_connect_andx_request") AND (Path="ADMIN$" OR Path="C$")Network Traffic FlowMonitor network data for uncommon SMB data flows. Processes utilizing the network that do not normally have network communication or have never been seen before are suspicious. Network Analysis frameworks such as Zeek can be used to capture, decode, and alert on SMB network flows.Notes:The logic for Implementation 1 is based around detecting on SMB write requests, which are often used by adversaries to move laterally to another host. Unlike SMB Reads, SMB Write requests typically require an additional level of access, resulting in less activity. Focusing on SMB Write activity narrows the field to looking at techniques associated with actively changing remote hosts, instead of passively reading files.The logic for Implementation 2 is based around detection of new processes that were created from a file written to an SMB share.  First, a file is remotely written to a host via an SMB share; then, a variety of Execution techniques can be used to remotely establish execution of the file or script. To detect this behavior, look for files that are written to a host over SMB and then later run directly as a process or in the command line arguments. SMB File Writes and Remote Execution may happen normally in an environment, but the combination of the two behaviors is less frequent and more likely to indicate adversarial activity.Analytic 1 - SMB Writesource="*Zeek:SMB_Files" port="445" AND protocol="smb.write"DS0009ProcessProcess CreationMonitor for the creation of WMI Win32_Process class and method Create to interact with a remote network share using Server Message Block (SMB). Relevant indicators detected by Bro/Zeek is IWbemServices::ExecMethod or IWbemServices::ExecMethodAsync. One thing to notice is that when the Create method is used on a remote system, the method is run under a host process named "Wmiprvse.exe".The process WmiprvSE.exe is what spawns the process defined in the CommandLine parameter of the Create method. Therefore, the new process created remotely will have Wmiprvse.exe as a parent. WmiprvSE.exe is a DCOM server and it is spawned underneath the DCOM service host svchost.exe with the following parameters C:\WINDOWS\system32\svchost.exe -k DcomLaunch -p. From a logon session perspective, on the target, WmiprvSE.exe is spawned in a different logon session by the DCOM service host. However, whatever is executed by WmiprvSE.exe occurs on the new network type (3) logon session created by the user that authenticated from the network.Analytic 1 - Basic(source="WinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode="1") OR (source="WinEventLog:Security" EventCode="4688") AND ParentImage="*wmiprvse.exe" AND TargetLogonID="0x3e7"ReferencesWikipedia. (2017, December 16). Server Message Block. Retrieved December 21, 2017.Microsoft. (2003, March 28). What Is RPC?. Retrieved June 12, 2016.Microsoft. (n.d.). How to create and delete hidden or administrative shares on client computers. Retrieved November 20, 2014.Joe Slowik. (2018, October 12). Anatomy of an Attack: Detecting and Defeating CRASHOVERRIDE. Retrieved December 18, 2020.Grange, W. (2020, July 13). Anchor_dns malware goes cross platform. Retrieved September 10, 2020.NSA, CISA, FBI, NCSC. (2021, July). Russian GRU Conducting Global Brute Force Campaign to Compromise Enterprise and Cloud Environments. Retrieved July 26, 2021.Symantec Security Response. (2016, September 6). Buckeye cyberespionage group shifts gaze from US to Hong Kong. Retrieved September 26, 2016.Dahan, A. (2017). Operation Cobalt Kitty. Retrieved December 27, 2018.Symantec. (2018, February 28). Chafer: Latest Attacks Reveal Heightened Ambitions. Retrieved May 22, 2020.Crowdstrike. (2020, March 2). 2020 Global Threat Report. Retrieved December 11, 2020.Baumgartner, K. and Garnaeva, M.. (2014, November 3). BE2 custom plugins, router abuse, and target profiles. Retrieved March 24, 2016.Lambert, T. (2020, May 7). Introducing Blue Mockingbird. Retrieved May 26, 2020.Harbison, M. and Renals, P. (2022, July 5). When Pentest Tools Go Brutal: Red-Teaming Tool Being Abused by Malicious Actors. Retrieved February 1, 2023.Chell, D.  PART 3: How I Met Your Beacon – Brute Ratel. Retrieved February 6, 2023.Dark Vortex. (n.d.). A Customized Command and Control Center for Red Team and Adversary Simulation. Retrieved February 7, 2023.Cycraft. (2020, April 15). APT Group Chimera - APT Operation Skeleton key Targets Taiwan Semiconductor Vendors. Retrieved August 24, 2020.Jansen, W . (2021, January 12). Abusing cloud services to fly under the radar. Retrieved January 19, 2021.Biderman, O. et al. (2022, October 3). REVEALING EMPEROR DRAGONFLY: NIGHT SKY AND CHEERSCRYPT - A SINGLE RANSOMWARE GROUP. Retrieved December 6, 2023.Cobalt Strike. (2017, December 8). Tactics, Techniques, and Procedures. Retrieved December 20, 2017.Kenefick, I. et al. (2022, October 12). Black Basta Ransomware Gang Infiltrates Networks via QAKBOT, Brute Ratel, and Cobalt Strike. Retrieved February 6, 2023.Burton, K. (n.d.). The Conficker Worm. Retrieved February 18, 2021.Rochberger, L. (2021, January 12). Cybereason vs. Conti Ransomware. Retrieved February 17, 2021.Baskin, B. (2020, July 8). TAU Threat Discovery: Conti Ransomware. Retrieved February 17, 2021.Meltzer, M. et al. (2024, January 10). Active Exploitation of Two Zero-Day Vulnerabilities in Ivanti Connect Secure VPN. Retrieved February 27, 2024.Alperovitch, D. (2014, July 7). Deep in Thought: Chinese Targeting of National Security Think Tanks. Retrieved November 12, 2014.Neeamni, D., Rubinfeld, A.. (2021, July 1). Diavol - A New Ransomware Used By Wizard Spider?. Retrieved November 12, 2021.Symantec Security Response. (2011, November). W32.Duqu: The precursor to the next Stuxnet. Retrieved September 17, 2015.Smith, A.. (2017, December 22). Protect your network from Emotet Trojan with Malwarebytes Endpoint Security. Retrieved January 17, 2019.Binary Defense. (n.d.). Emotet Evolves With new Wi-Fi Spreader. Retrieved September 8, 2023.Sygnia Incident Response Team. (2022, January 5). TG2003: ELEPHANT BEETLE UNCOVERING AN ORGANIZED FINANCIAL-THEFT OPERATION. Retrieved February 9, 2023.Elovitz, S. & Ahl, I. (2016, August 18). Know Your Enemy:  New Financially-Motivated & Spear-Phishing Group. Retrieved February 26, 2018.Budaca, E., et al. (2021, August 25). FIN8 Threat Actor Goes Agile with New Sardonic Backdoor. Retrieved August 9, 2023.CISA. (2020, September 15). Iran-Based Threat Actor Exploits VPN Vulnerabilities. Retrieved December 21, 2020.ESET. (2022, March 1). IsaacWiper and HermeticWizard: New wiper and worm targetingUkraine. Retrieved April 10, 2022.Villeneuve, N., Bennett, J. T., Moran, N., Haq, T., Scott, M., & Geers, K. (2014). OPERATION “KE3CHANG”: Targeted Attacks Against Ministries of Foreign Affairs. Retrieved November 12, 2014.Smallridge, R. (2018, March 10). APT15 is alive and strong: An analysis of RoyalCli and RoyalDNS. Retrieved April 4, 2018.Symantec Security Response Attack Investigation Team. (2018, April 23). New Orangeworm attack group targets the healthcare sector in the U.S., Europe, and Asia. Retrieved May 8, 2018.Novetta Threat Research Group. (2016, February 24). Operation Blockbuster: Unraveling the Long Thread of the Sony Attack. Retrieved February 25, 2016.Novetta Threat Research Group. (2016, February 24). Operation Blockbuster: Remote Administration Tools & Content Staging Malware Report. Retrieved March 16, 2016.Hsu, K. et al. (2020, June 24). Lucifer: New Cryptojacking and DDoS Hybrid Malware Exploiting High and Critical Vulnerabilities to Infect Windows Devices. Retrieved November 16, 2020.Checkpoint Research. (2021, November 15). Uncovering MosesStaff techniques: Ideology over Money. Retrieved August 11, 2022.Savill, J. (1999, March 4). Net.exe reference. Retrieved September 22, 2015.Cylance. (2014, December). Operation Cleaver. Retrieved September 14, 2017.Chiu, A. (2016, June 27). New Ransomware Variant "Nyetya" Compromises Systems Worldwide. Retrieved March 26, 2019.US-CERT. (2017, July 1). Alert (TA17-181A): Petya Ransomware. Retrieved March 15, 2019.Russinovich, M. (2004, June 28). PsExec. Retrieved December 17, 2015.Mercer, W. and Rascagneres, P. (2018, February 12). Olympic Destroyer Takes Aim At Winter Olympics. Retrieved March 14, 2019.Dantzig, M. v., Schamper, E. (2019, December 19). Operation Wocao: Shining a light on one of China’s hidden hacking groups. Retrieved October 8, 2020.Kaspersky Lab's Global Research and Analysis Team. (2014, November 24). THE REGIN PLATFORM NATION-STATE OWNAGE OF GSM NETWORKS. Retrieved December 1, 2014.Cybereason Global SOC and Cybereason Security Research Teams. (2022, December 14). Royal Rumble: Analysis of Royal Ransomware. Retrieved March 30, 2023.Abrams, L. (2021, January 14). Ryuk Ransomware Uses Wake-on-Lan To Encrypt Offline Devices. Retrieved February 11, 2021.MSTIC. (2022, October 14). New “Prestige” ransomware impacts organizations in Ukraine and Poland. Retrieved January 19, 2023.FireEye. (2016, November 30). FireEye Responds to Wave of Destructive Cyber Attacks in Gulf Region. Retrieved January 11, 2017.CrowdStrike. (2022, January 27). Early Bird Catches the Wormhole: Observations from the StellarParticle Campaign. Retrieved February 7, 2022.Nicolas Falliere, Liam O Murchu, Eric Chien 2011, February W32.Stuxnet Dossier (Version 1.4) Retrieved. 2017/09/22Dell SecureWorks Counter Threat Unit Special Operations Team. (2015, May 28). Living off the Land. Retrieved January 26, 2016.Dedola, G. et al. (2023, October 12). ToddyCat: Keep calm and check logs. Retrieved January 3, 2024.Kaspersky Lab's Global Research and Analysis Team. (2014, August 7). The Epic Turla Operation: Solving some of the mysteries of Snake/Uroburos. Retrieved December 11, 2014.The DFIR Report. (2020, November 5). Ryuk Speed Run, 2 Hours to Ransom. Retrieved November 6, 2020.The DFIR Report. (2020, October 8). Ryuk’s Return. Retrieved October 9, 2020.Novetta. (n.d.). Operation SMN: Axiom Threat Actor Group Report. Retrieved November 12, 2014.McAfee® Foundstone® Professional Services and McAfee Labs™. (2011, February 10). Global Energy Cyberattacks: “Night Dragon”. Retrieved February 19, 2018.Microsoft. (2020, March 10). Preventing SMB traffic from lateral connections and entering or leaving the network. Retrieved June 1, 2020.French, D. (2018, October 9). Detecting & Removing an Attacker’s WMI Persistence. Retrieved October 11, 2019.Payne, J. (2015, November 26). Tracking Lateral Movement Part One - Special Groups and Specific Service Accounts. Retrieved February 1, 2016.Payne, J. (2015, November 23). Monitoring what matters - Windows Event Forwarding for everyone (even if you already have a SIEM.). Retrieved February 1, 2016.×load more resultsContact UsTerms of UsePrivacy PolicyWebsite Changelog© 2015 - 2024, The MITRE Corporation. MITRE ATT&CK and ATT&CK are registered trademarks of The MITRE Corporation.