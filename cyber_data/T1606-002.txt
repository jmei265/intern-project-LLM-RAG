MatricesEnterpriseMobileICSTacticsEnterpriseMobileICSTechniquesEnterpriseMobileICSDefensesData SourcesMitigationsEnterpriseMobileICSAssetsCTIGroupsSoftwareCampaignsResourcesGet StartedLearn More about ATT&CKATT&CKconATT&CK Data & ToolsFAQEngage with ATT&CKVersion HistoryLegal & BrandingBenefactorsBlogSearchATT&CKcon 5.0 returns October 22-23, 2024 in McLean, VA.Register heretoday!HomeTechniquesEnterpriseForge Web CredentialsSAML TokensForge Web Credentials:SAML TokensOther sub-techniques of Forge Web Credentials (2)IDNameT1606.001Web CookiesT1606.002SAML TokensAn adversary may forge SAML tokens with any permissions claims and lifetimes if they possess a valid SAML token-signing certificate.[1]The default lifetime of a SAML token is one hour, but the validity period can be specified in theNotOnOrAftervalue of theconditions ...element in a token. This value can be changed using theAccessTokenLifetimein aLifetimeTokenPolicy.[2]Forged SAML tokens enable adversaries to authenticate across services that use SAML 2.0 as an SSO (single sign-on) mechanism.[3]An adversary may utilizePrivate Keysto compromise an organization's token-signing certificate to create forged SAML tokens. If the adversary has sufficient permissions to establish a new federation trust with their own Active Directory Federation Services (AD FS) server, they may instead generate their own trusted token-signing certificate.[4]This differs fromSteal Application Access Tokenand other similar behaviors in that the tokens are new and forged by the adversary, rather than stolen or intercepted from legitimate users.An adversary may gain administrative Azure AD privileges if a SAML token is forged which claims to represent a highly privileged account. This may lead toUse Alternate Authentication Material, which may bypass multi-factor and other authentication protection mechanisms.[4]ID:T1606.002Sub-technique of:T1606ⓘTactic:Credential AccessⓘPlatforms:Azure AD, Google Workspace, IaaS, Office 365, SaaS, WindowsContributors:Blake Strom, Microsoft 365 Defender; Jack Burns, HubSpot; Oleg Kolesnikov, SecuronixVersion:1.3Created:17 December 2020Last Modified:01 March 2024Version PermalinkLive VersionProcedure ExamplesIDNameDescriptionS0677AADInternalsAADInternalscan be used to create SAML tokens using the AD Federated Services token signing certificate.[5]C0024SolarWinds CompromiseDuring theSolarWinds Compromise,APT29created tokens using compromised SAML signing certificates.[6][7]MitigationsIDMitigationDescriptionM1015Active Directory ConfigurationFor containing the impact of a previously forged SAML token, rotate the token-signing AD FS certificate in rapid succession twice, which will invalidate any tokens generated using the previous certificate.[8]M1047AuditEnable advanced auditing on AD FS. Check the success and failure audit options in the AD FS Management snap-in. Enable Audit Application Generated events on the AD FS farm via Group Policy Object.[9]M1026Privileged Account ManagementRestrict permissions and access to the AD FS server to only originate from privileged access workstations.[9]M1018User Account ManagementEnsure that user accounts with administrative rights follow best practices, including use of privileged access workstations, Just in Time/Just Enough Administration (JIT/JEA), and strong authentication. Reduce the number of users that are members of highly privileged Directory Roles.[4]DetectionIDData SourceData ComponentDetectsDS0028Logon SessionLogon Session CreationMonitor for logins using SAML tokens which do not have corresponding 4769 and 1200 events in the domain.[10]These logins may occur on any on-premises resources as well as from any cloud environment that trusts the certificate.[4]Logon Session MetadataConsider modifying SAML responses to include custom elements for each service provider. Monitor these custom elements in service provider access logs to detect any anomalous requests.[10]DS0009ProcessProcess CreationThis search looks for arguments to certutil.exe indicating the manipulation or extraction of Certificate. This certificate can then be used to sign new authentication tokens specially inside Federated environments such as Windows ADFS.Analytic 1 - Certutil.exe Certificate Extraction(source="WinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode="1") OR (source="WinEventLog:Security" EventCode="4688") AND Image= "C:\Windows\System32\certutil.exe" AND CommandLine= "-exportPFX")DS0002User AccountUser Account AuthenticationMonitor for user authentication attempts, when requesting access tokens to services, that failed because of Conditional Access Policies (CAP). Some SAML tokens features, such as the location of a user, may not be as easy to claim.DS0006Web CredentialWeb Credential CreationMonitor for creation of access tokens using SAML tokens which do not have corresponding 4769 and 1200 events in the domain.[10]Web Credential UsageMonitor for the use of access tokens to access services such as email that were created using SAML tokens which do not have corresponding 1202 events (i.e. "The Federation Service validated a new credential") in the domain.[10]ReferencesLambert, J. (2020, December 13). Important steps for customers to protect themselves from recent nation-state cyberattacks. Retrieved December 17, 2020.Microsoft. (2020, December 14). Configurable token lifetimes in Microsoft Identity Platform. Retrieved December 22, 2020.Reiner, S. (2017, November 21). Golden SAML: Newly Discovered Attack Technique Forges Authentication to Cloud Apps. Retrieved December 17, 2020.MSRC. (2020, December 13). Customer Guidance on Recent Nation-State Cyber Attacks. Retrieved December 17, 2020.Dr. Nestori Syynimaa. (2018, October 25). AADInternals. Retrieved February 18, 2022.MSRC. (2020, December 13). Customer Guidance on Recent Nation-State Cyber Attacks. Retrieved December 30, 2020.Secureworks CTU. (n.d.). IRON RITUAL. Retrieved February 24, 2022.Mandiant. (2021, January 19). Remediation and Hardening Strategies for Microsoft 365 to Defend Against UNC2452. Retrieved January 22, 2021.Bierstock, D., Baker, A. (2019, March 21). I am AD FS and So Can You. Retrieved December 17, 2020.Sygnia. (2020, December). Detection and Hunting of Golden SAML Attack. Retrieved January 6, 2021.×load more resultsContact UsTerms of UsePrivacy PolicyWebsite Changelog© 2015 - 2024, The MITRE Corporation. MITRE ATT&CK and ATT&CK are registered trademarks of The MITRE Corporation.