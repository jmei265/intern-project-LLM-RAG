MatricesEnterpriseMobileICSTacticsEnterpriseMobileICSTechniquesEnterpriseMobileICSDefensesData SourcesMitigationsEnterpriseMobileICSAssetsCTIGroupsSoftwareCampaignsResourcesGet StartedLearn More about ATT&CKATT&CKconATT&CK Data & ToolsFAQEngage with ATT&CKVersion HistoryLegal & BrandingBenefactorsBlogSearchATT&CKcon 5.0 returns October 22-23, 2024 in McLean, VA.Register heretoday!HomeTechniquesEnterpriseProcess InjectionAsynchronous Procedure CallProcess Injection:Asynchronous Procedure CallOther sub-techniques of Process Injection (12)IDNameT1055.001Dynamic-link Library InjectionT1055.002Portable Executable InjectionT1055.003Thread Execution HijackingT1055.004Asynchronous Procedure CallT1055.005Thread Local StorageT1055.008Ptrace System CallsT1055.009Proc MemoryT1055.011Extra Window Memory InjectionT1055.012Process HollowingT1055.013Process DoppelgängingT1055.014VDSO HijackingT1055.015ListPlantingAdversaries may inject malicious code into processes via the asynchronous procedure call (APC) queue in order to evade process-based defenses as well as possibly elevate privileges. APC injection is a method of executing arbitrary code in the address space of a separate live process.APC injection is commonly performed by attaching malicious code to the APC Queue[1]of a process's thread. Queued APC functions are executed when the thread enters an alterable state.[1]A handle to an existing victim process is first created with native Windows API calls such asOpenThread. At this pointQueueUserAPCcan be used to invoke a function (such asLoadLibrayApointing to a malicious DLL).A variation of APC injection, dubbed "Early Bird injection", involves creating a suspended process in which malicious code can be written and executed before the process' entry point (and potentially subsequent anti-malware hooks) via an APC.[2]AtomBombing[3]is another variation that utilizes APCs to invoke malicious code previously written to the global atom table.[4]Running code in the context of another process may allow access to the process's memory, system/network resources, and possibly elevated privileges. Execution via APC injection may also evade detection from security products since the execution is masked under a legitimate process.ID:T1055.004Sub-technique of:T1055ⓘTactics:Defense Evasion,Privilege EscalationⓘPlatforms:WindowsⓘDefense Bypassed:Anti-virus, Application controlVersion:1.1Created:14 January 2020Last Modified:18 October 2021Version PermalinkLive VersionProcedure ExamplesIDNameDescriptionS0438AttorAttorperforms the injection by attaching its code into the APC queue using NtQueueApcThread API.[5]S1081BADHATCHBADHATCHcan inject itself into a newsvchost.exe -k netsvcsprocess using the asynchronous procedure call (APC) queue.[6][7]S1039BumblebeeBumblebeecan use asynchronous procedure call (APC) injection to execute commands received from C2.[8]S0484CarberpCarberphas queued an APC routine to explorer.exe by calling ZwQueueApcThread.[9]G0061FIN8FIN8has injected malicious code into a new svchost.exe process.[10]S0483IcedIDIcedIDhas usedZwQueueApcThreadto inject itself into remote processes.[11]S0260InvisiMoleInvisiMolecan inject its code into a trusted process via the APC queue.[12]S0517PillowmintPillowminthas used the NtQueueApcThread syscall to inject code into svchost.exe.[13]S1018Saint BotSaint Bothas written its payload into a newly-createdEhStorAuthn.exeprocess usingZwWriteVirtualMemoryand executed it usingNtQueueApcThreadandZwAlertResumeThread.[14]S1085SardonicSardoniccan use theQueueUserAPCAPI to execute shellcode on a compromised machine.[15]S0199TURNEDUPTURNEDUPis capable of injecting code into the APC queue of a createdRundll32process as part of an "Early Bird injection."[2]MitigationsIDMitigationDescriptionM1040Behavior Prevention on EndpointSome endpoint security solutions can be configured to block some types of process injection based on common sequences of behavior that occur during the injection process.DetectionIDData SourceData ComponentDetectsDS0009ProcessOS API ExecutionMonitoring Windows API calls indicative of the various types of code injection may generate a significant amount of data and may not be directly useful for defense unless collected under specific circumstances for known bad sequences of calls, since benign use of API functions may be common and difficult to distinguish from malicious behavior. Windows API calls such asSuspendThread/SetThreadContext/ResumeThread,QueueUserAPC/NtQueueApcThread, and those that can be used to modify memory within another process, such asVirtualAllocEx/WriteProcessMemory, may be used for this technique.[16]Process AccessMonitor for processes being viewed that may inject malicious code into processes via the asynchronous procedure call (APC) queue in order to evade process-based defenses as well as possibly elevate privileges.Process ModificationMonitor for changes made to processes that may inject malicious code into processes via the asynchronous procedure call (APC) queue in order to evade process-based defenses as well as possibly elevate privileges.ReferencesMicrosoft. (n.d.). Asynchronous Procedure Calls. Retrieved December 8, 2017.Gavriel, H. & Erbesfeld, B. (2018, April 11). New ‘Early Bird’ Code Injection Technique Discovered. Retrieved May 24, 2018.Liberman, T. (2016, October 27). ATOMBOMBING: BRAND NEW CODE INJECTION FOR WINDOWS. Retrieved December 8, 2017.Microsoft. (n.d.). About Atom Tables. Retrieved December 8, 2017.Hromcova, Z. (2019, October). AT COMMANDS, TOR-BASED COMMUNICATIONS: MEET ATTOR, A FANTASY CREATURE AND ALSO A SPY PLATFORM. Retrieved May 6, 2020.Savelesky, K., et al. (2019, July 23). ABADBABE 8BADFOOD: Discovering BADHATCH and a Detailed Look at FIN8's Tooling. Retrieved September 8, 2021.Vrabie, V., et al. (2021, March 10). FIN8 Returns with Improved BADHATCH Toolkit. Retrieved September 8, 2021.Merriman, K. and Trouerbach, P. (2022, April 28). This isn't Optimus Prime's Bumblebee but it's Still Transforming. Retrieved August 22, 2022.Giuliani, M., Allievi, A. (2011, February 28). Carberp - a modular information stealing trojan. Retrieved July 15, 2020.Martin Zugec. (2021, July 27). Deep Dive Into a FIN8 Attack - A Forensic Investigation. Retrieved September 1, 2021.Kessem, L., et al. (2017, November 13). New Banking Trojan IcedID Discovered by IBM X-Force Research. Retrieved July 14, 2020.Hromcova, Z. and Cherpanov, A. (2020, June). INVISIMOLE: THE HIDDEN PART OF THE STORY. Retrieved July 16, 2020.Trustwave SpiderLabs. (2020, June 22). Pillowmint: FIN7’s Monkey Thief . Retrieved July 27, 2020.Hasherezade. (2021, April 6). A deep dive into Saint Bot, a new downloader. Retrieved June 9, 2022.Symantec Threat Hunter Team. (2023, July 18). FIN8 Uses Revamped Sardonic Backdoor to Deliver Noberus Ransomware. Retrieved August 9, 2023.Hosseini, A. (2017, July 18). Ten Process Injection Techniques: A Technical Survey Of Common And Trending Process Injection Techniques. Retrieved December 7, 2017.×load more resultsContact UsTerms of UsePrivacy PolicyWebsite Changelog© 2015 - 2024, The MITRE Corporation. MITRE ATT&CK and ATT&CK are registered trademarks of The MITRE Corporation.