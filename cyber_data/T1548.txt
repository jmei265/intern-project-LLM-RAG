MatricesEnterpriseMobileICSTacticsEnterpriseMobileICSTechniquesEnterpriseMobileICSDefensesData SourcesMitigationsEnterpriseMobileICSAssetsCTIGroupsSoftwareCampaignsResourcesGet StartedLearn More about ATT&CKATT&CKconATT&CK Data & ToolsFAQEngage with ATT&CKVersion HistoryLegal & BrandingBenefactorsBlogSearchATT&CKcon 5.0 returns October 22-23, 2024 in McLean, VA.Register heretoday!HomeTechniquesEnterpriseAbuse Elevation Control MechanismAbuse Elevation Control MechanismSub-techniques (6)IDNameT1548.001Setuid and SetgidT1548.002Bypass User Account ControlT1548.003Sudo and Sudo CachingT1548.004Elevated Execution with PromptT1548.005Temporary Elevated Cloud AccessT1548.006TCC ManipulationAdversaries may circumvent mechanisms designed to control elevate privileges to gain higher-level permissions. Most modern systems contain native elevation control mechanisms that are intended to limit privileges that a user can perform on a machine. Authorization has to be granted to specific users in order to perform tasks that can be considered of higher risk.[1][2]An adversary can perform several methods to take advantage of built-in control mechanisms in order to escalate privileges on a system.[3][4]ID:T1548Sub-techniques:T1548.001,T1548.002,T1548.003,T1548.004,T1548.005,T1548.006ⓘTactics:Privilege Escalation,Defense EvasionⓘPlatforms:Azure AD, Google Workspace, IaaS, Linux, Office 365, Windows, macOSⓘPermissions Required:Administrator, UserVersion:1.3Created:30 January 2020Last Modified:15 April 2024Version PermalinkLive VersionMitigationsIDMitigationDescriptionM1047AuditCheck for common UAC bypass weaknesses on Windows systems to be aware of the risk posture and address issues where appropriate.[5]M1038Execution PreventionSystem settings can prevent applications from running that haven't been downloaded from legitimate repositories which may help mitigate some of these issues. Not allowing unsigned applications from being run may also mitigate some risk.M1028Operating System ConfigurationApplications with known vulnerabilities or known shell escapes should not have the setuid or setgid bits set to reduce potential damage if an application is compromised. Additionally, the number of programs with setuid or setgid bits set should be minimized across a system. Ensuring that the sudo tty_tickets setting is enabled will prevent this leakage across tty sessions.M1026Privileged Account ManagementRemove users from the local administrator group on systems.By requiring a password, even if an adversary can get terminal access, they must know the password to run anything in the sudoers file. Setting the timestamp_timeout to 0 will require the user to input their password every time sudo is executed.M1022Restrict File and Directory PermissionsThe sudoers file should be strictly edited such that passwords are always required and that users can't spawn risky processes as users with higher privilege.M1051Update SoftwarePerform regular software updates to mitigate exploitation risk.M1052User Account ControlAlthough UAC bypass techniques exist, it is still prudent to use the highest enforcement level for UAC when possible and mitigate bypass opportunities that exist with techniques such asDLL Search Order Hijacking.M1018User Account ManagementLimit the privileges of cloud accounts to assume, create, or impersonate additional roles, policies, and permissions to only those required. Where just-in-time access is enabled, consider requiring manual approval for temporary elevation of privileges.DetectionIDData SourceData ComponentDetectsDS0017CommandCommand ExecutionMonitor executed commands and arguments that may circumvent mechanisms designed to control elevate privileges to gain higher-level permissions.DS0022FileFile MetadataMonitor the file system for files that have the setuid or setgid bits set. On Linux, auditd can alert every time a user's actual ID and effective ID are different (this is what happens when you sudo).File ModificationOn Linux, auditd can alert every time a user's actual ID and effective ID are different (this is what happens when you sudo). This technique is abusing normal functionality in macOS and Linux systems, but sudo has the ability to log all input and output based on theLOG_INPUTandLOG_OUTPUTdirectives in the/etc/sudoersfile. Consider monitoring for/usr/libexec/security_authtrampolineexecutions which may indicate that AuthorizationExecuteWithPrivileges is being executed. MacOS system logs may also indicate when AuthorizationExecuteWithPrivileges is being called.DS0009ProcessOS API ExecutionAlso look for any process API calls for behavior that may be indicative ofProcess Injection. Monitoring OS API callbacks for the execution can also be a way to detect this behavior but requires specialized security tooling.Process CreationMonitor for newly executed processes that may circumvent mechanisms designed to control elevate privileges to gain higher-level permissions. Cyber actors frequently escalate to the SYSTEM account after gaining entry to a Windows host, to enable them to carry out various attacks more effectively. Tools such as Meterpreter, Cobalt Strike, and Empire carry out automated steps to "Get System", which is the same as switching over to the System user account. Most of these tools utilize multiple techniques to try and attain SYSTEM: in the first technique, they create a named pipe and connects an instance of cmd.exe to it, which allows them to impersonate the security context of cmd.exe, which is SYSTEM. In the second technique, a malicious DLL is injected into a process that is running as SYSTEM; the injected DLL steals the SYSTEM token and applies it where necessary to escalate privileges. This analytic looks for both of these techniques.Analytic 1 - Get System Elevation(source="WinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode="1") OR (source="WinEventLog:Security" EventCode="4688")(ParentImage="C:\Windows\System32\services.exe" Image="C:\Windows\System32\cmd.exe"  CommandLine="echo" CommandLine="\pipe*") OR (Image="C:\Windows\System32\rundll32.exe" CommandLine=",a /p:*")Process MetadataMonitor contextual data about a running process, which may include information such as environment variables, image name, user/owner that may circumvent mechanisms designed to control elevate privileges to gain higher-level permissions.DS0002User AccountUser Account ModificationLog cloud API calls to assume, create, or impersonate additional roles, policies, and permissions. Review uses of just-in-time access to ensure that any justifications provided are valid and only expected actions were taken.DS0024Windows RegistryWindows Registry Key ModificationThere are many ways to perform UAC bypasses when a user is in the local administrator group on a system, so it may be difficult to target detection on all variations. Efforts should likely be placed on mitigation and collecting enough information on process launches and actions that could be performed before and after a UAC bypass is performed. Some UAC bypass methods rely on modifying specific, user-accessible Registry settings. Analysts should monitor Registry settings for unauthorized changes.ReferencesLich, B. (2016, May 31). How User Account Control Works. Retrieved June 3, 2016.Todd C. Miller. (2018). Sudo Man Page. Retrieved March 19, 2018.Marc-Etienne M.Leveille. (2016, July 6). New OSX/Keydnap malware is hungry for credentials. Retrieved July 3, 2017.Salvio, J., Joven, R. (2016, December 16). Malicious Macro Bypasses UAC to Elevate Privilege for Fareit Malware. Retrieved December 27, 2016.UACME Project. (2016, June 16). UACMe. Retrieved July 26, 2016.×load more resultsContact UsTerms of UsePrivacy PolicyWebsite Changelog© 2015 - 2024, The MITRE Corporation. MITRE ATT&CK and ATT&CK are registered trademarks of The MITRE Corporation.