MatricesEnterpriseMobileICSTacticsEnterpriseMobileICSTechniquesEnterpriseMobileICSDefensesData SourcesMitigationsEnterpriseMobileICSAssetsCTIGroupsSoftwareCampaignsResourcesGet StartedLearn More about ATT&CKATT&CKconATT&CK Data & ToolsFAQEngage with ATT&CKVersion HistoryLegal & BrandingBenefactorsBlogSearchATT&CKcon 5.0 returns October 22-23, 2024 in McLean, VA.Register heretoday!HomeTechniquesEnterpriseDomain Trust DiscoveryDomain Trust DiscoveryAdversaries may attempt to gather information on domain trust relationships that may be used to identify lateral movement opportunities in Windows multi-domain/forest environments. Domain trusts provide a mechanism for a domain to allow access to resources based on the authentication procedures of another domain.[1]Domain trusts allow the users of the trusted domain to access resources in the trusting domain. The information discovered may help the adversary conductSID-History Injection,Pass the Ticket, andKerberoasting.[2][3]Domain trusts can be enumerated using theDSEnumerateDomainTrusts()Win32 API call, .NET methods, and LDAP.[3]The Windows utilityNltestis known to be used by adversaries to enumerate domain trusts.[4]ID:T1482Sub-techniques:No sub-techniquesⓘTactic:DiscoveryⓘPlatforms:WindowsContributors:Dave Westgard; Elia Florio, Microsoft; ExtraHop; Mnemonic; RedHuntLabs, @redhuntlabsVersion:1.2Created:14 February 2019Last Modified:16 June 2022Version PermalinkLive VersionProcedure ExamplesIDNameDescriptionS0552AdFindAdFindcan gather information about organizational units (OUs) and domain trusts from Active Directory.[5][6][7][8]G1024AkiraAkirauses the built-inNltestutility or tools such asAdFindto enumerate Active Directory trusts in victim environments.[9]S1081BADHATCHBADHATCHcan usenltest.exe /domain_truststo discover domain trust relationships on a compromised machine.[10]S0534BazarBazarcan useNltesttools to obtain information about the domain.[11][12]S0521BloodHoundBloodHoundhas the ability to map domain trusts and identify misconfigurations for potential abuse.[13]S1063Brute Ratel C4Brute Ratel C4can use LDAP queries andnltest /domain_trustsfor domain trust discovery.[14][15]C0015C0015DuringC0015, the threat actors used the commandnltest /domain_trusts /all_truststo enumerate domain trusts.[16]G0114ChimeraChimerahasnltest /domain_truststo identify domain trust relationships.[17]S0105dsquerydsquerycan be used to gather information on domain trusts withdsquery * -filter "(objectClass=trustedDomain)" -attr *.[3]G1006Earth LuscaEarth Luscahas usedNltestto obtain information about domain controllers.[18]S0363EmpireEmpirehas modules for enumerating domain trusts.[19]G0061FIN8FIN8has retrieved a list of trusted domains by usingnltest.exe /domain_trusts.[20]G0059Magic HoundMagic Houndhas used a web shell to executenltest /trusted_domainsto identify trust relationships.[21]S0359NltestNltestmay be used to enumerate trusted domains by using commands such asnltest /domain_trusts.[22][23]S0378PoshC2PoshC2has modules for enumerating domain trusts.[24]S0194PowerSploitPowerSploithas modules such asGet-NetDomainTrustandGet-NetForestTrustto enumerate domain and forest trusts.[25][26]S0650QakBotQakBotcan runnltest /domain_trusts /all_trustsfor domain trust discovery.[27]S1071RubeusRubeuscan gather information about domain trusts.[28][29]S1124SocGholishSocGholishcan profile compromised systems to identify domain trust relationships.[30][31]C0024SolarWinds CompromiseDuring theSolarWinds Compromise,APT29used theGet-AcceptedDomainPowerShell cmdlet to enumerate accepted domains through an Exchange Management Shell.[32]They also usedAdFindto enumerate domains and to discover trust between federated domains.[33][34]S0266TrickBotTrickBotcan gather information about domain trusts by utilizingNltest.[23][35]MitigationsIDMitigationDescriptionM1047AuditMap the trusts within existing domains/forests and keep trust relationships to a minimum.M1030Network SegmentationEmploy network segmentation for sensitive domains.[3].DetectionIDData SourceData ComponentDetectsDS0017CommandCommand ExecutionMonitor executed commands and arguments for actions that could be taken to gather system and network information, such as nltest /domain_trusts. Remote access tools with built-in features may interact directly with the Windows API to gather information.DS0029Network TrafficNetwork Traffic ContentMonitor and analyze traffic patterns and packet inspection associated to LDAP and MSRPC that do not follow the expected protocol standards and traffic flows (e.g extraneous packets that do not belong to established flows, gratuitous or anomalous traffic patterns, anomalous syntax, or structure).DS0009ProcessOS API ExecutionMonitor for API calls associated with gathering information on domain trust relationships that may be used to identify lateral movement like DSEnumerateDomainTrusts() Win32 API call to spot activity associated with Domain Trust Discovery.[3]Information may also be acquired through Windows system management tools such as PowerShell. The .NET method GetAllTrustRelationships() can be an indicator of Domain Trust Discovery.[36]Process CreationMonitor for newly executed processes that may attempt to gather information on domain trust relationships that may be used to identify lateral movement opportunities in Windows multi-domain/forest environments.DS0012ScriptScript ExecutionMonitor for any attempts to enable scripts running on a system would be considered suspicious. If scripts are not commonly used on a system, but enabled, scripts running out of cycle from patching or other administrator functions are suspicious. Scripts should be captured from the file system when possible to determine their actions and intent.ReferencesMicrosoft. (2009, October 7). Trust Technologies. Retrieved February 14, 2019.Metcalf, S. (2015, July 15). It’s All About Trust – Forging Kerberos Trust Tickets to Spoof Access across Active Directory Trusts. Retrieved February 14, 2019.Schroeder, W. (2017, October 30). A Guide to Attacking Domain Trusts. Retrieved February 14, 2019.Florio, E.. (2017, May 4). Windows Defender ATP thwarts Operation WilySupply software supply chain cyberattack. Retrieved February 14, 2019.Brian Donohue, Katie Nickels, Paul Michaud, Adina Bodkins, Taylor Chapman, Tony Lambert, Jeff Felling, Kyle Rainey, Mike Haag, Matt Graeber, Aaron Didier.. (2020, October 29). A Bazar start: How one hospital thwarted a Ryuk ransomware outbreak. Retrieved October 30, 2020.McKeague, B. et al. (2019, April 5). Pick-Six: Intercepting a FIN6 Intrusion, an Actor Recently Tied to Ryuk and LockerGoga Ransomware. Retrieved April 17, 2019.Goody, K., et al (2019, January 11). A Nasty Trick: From Credential Theft Malware to Business Disruption. Retrieved May 12, 2020.Kamble, V. (2022, June 28). Bumblebee: New Loader Rapidly Assuming Central Position in Cyber-crime Ecosystem. Retrieved August 24, 2022.Steven Campbell, Akshay Suthar, & Connor Belfiorre. (2023, July 26). Conti and Akira: Chained Together. Retrieved February 20, 2024.Vrabie, V., et al. (2021, March 10). FIN8 Returns with Improved BADHATCH Toolkit. Retrieved September 8, 2021.Cybereason Nocturnus. (2020, July 16). A BAZAR OF TRICKS: FOLLOWING TEAM9’S DEVELOPMENT CYCLES. Retrieved November 18, 2020.Pantazopoulos, N. (2020, June 2). In-depth analysis of the new Team9 malware family. Retrieved December 1, 2020.Red Team Labs. (2018, April 24). Hidden Administrative Accounts: BloodHound to the Rescue. Retrieved October 28, 2020.Harbison, M. and Renals, P. (2022, July 5). When Pentest Tools Go Brutal: Red-Teaming Tool Being Abused by Malicious Actors. Retrieved February 1, 2023.Kenefick, I. et al. (2022, October 12). Black Basta Ransomware Gang Infiltrates Networks via QAKBOT, Brute Ratel, and Cobalt Strike. Retrieved February 6, 2023.DFIR Report. (2021, November 29). CONTInuing the Bazar Ransomware Story. Retrieved September 29, 2022.Jansen, W . (2021, January 12). Abusing cloud services to fly under the radar. Retrieved January 19, 2021.Chen, J., et al. (2022). Delving Deep: An Analysis of Earth Lusca’s Operations. Retrieved July 1, 2022.Schroeder, W., Warner, J., Nelson, M. (n.d.). Github PowerShellEmpire. Retrieved April 28, 2016.Martin Zugec. (2021, July 27). Deep Dive Into a FIN8 Attack - A Forensic Investigation. Retrieved September 1, 2021.DFIR Report. (2021, November 15). Exchange Exploit Leads to Domain Wide Ransomware. Retrieved January 5, 2023.ss64. (n.d.). NLTEST.exe - Network Location Test. Retrieved February 14, 2019.Bacurio Jr., F. and Salvio, J. (2018, April 9). Trickbot’s New Reconnaissance Plugin. Retrieved February 14, 2019.Nettitude. (2018, July 23). Python Server for PoshC2. Retrieved April 23, 2019.PowerShellMafia. (2012, May 26). PowerSploit - A PowerShell Post-Exploitation Framework. Retrieved February 6, 2018.PowerSploit. (n.d.). PowerSploit. Retrieved February 6, 2018.Kuzmenko, A. et al. (2021, September 2). QakBot technical analysis. Retrieved September 27, 2021.The DFIR Report. (2020, October 8). Ryuk’s Return. Retrieved October 9, 2020.The DFIR Report. (2020, November 5). Ryuk Speed Run, 2 Hours to Ransom. Retrieved November 6, 2020.Andrew Northern. (2022, November 22). SocGholish, a very real threat from a very fake update. Retrieved February 13, 2024.Red Canary. (2024, March). Red Canary 2024 Threat Detection Report: SocGholish. Retrieved March 22, 2024.Cash, D. et al. (2020, December 14). Dark Halo Leverages SolarWinds Compromise to Breach Organizations. Retrieved December 29, 2020.CrowdStrike. (2022, January 27). Early Bird Catches the Wormhole: Observations from the StellarParticle Campaign. Retrieved February 7, 2022.MSTIC, CDOC, 365 Defender Research Team. (2021, January 20). Deep dive into the Solorigate second-stage activation: From SUNBURST to TEARDROP and Raindrop . Retrieved January 22, 2021.Dahan, A. et al. (2019, December 11). DROPPING ANCHOR: FROM A TRICKBOT INFECTION TO THE DISCOVERY OF THE ANCHOR MALWARE. Retrieved September 10, 2020.Microsoft. (n.d.). Domain.GetAllTrustRelationships Method. Retrieved February 14, 2019.×load more resultsContact UsTerms of UsePrivacy PolicyWebsite Changelog© 2015 - 2024, The MITRE Corporation. MITRE ATT&CK and ATT&CK are registered trademarks of The MITRE Corporation.