MatricesEnterpriseMobileICSTacticsEnterpriseMobileICSTechniquesEnterpriseMobileICSDefensesData SourcesMitigationsEnterpriseMobileICSAssetsCTIGroupsSoftwareCampaignsResourcesGet StartedLearn More about ATT&CKATT&CKconATT&CK Data & ToolsFAQEngage with ATT&CKVersion HistoryLegal & BrandingBenefactorsBlogSearchATT&CKcon 5.0 returns October 22-23, 2024 in McLean, VA.Register heretoday!HomeTechniquesEnterpriseAccount ManipulationSSH Authorized KeysAccount Manipulation:SSH Authorized KeysOther sub-techniques of Account Manipulation (6)IDNameT1098.001Additional Cloud CredentialsT1098.002Additional Email Delegate PermissionsT1098.003Additional Cloud RolesT1098.004SSH Authorized KeysT1098.005Device RegistrationT1098.006Additional Container Cluster RolesAdversaries may modify the SSHauthorized_keysfile to maintain persistence on a victim host. Linux distributions and macOS commonly use key-based authentication to secure the authentication process of SSH sessions for remote management. Theauthorized_keysfile in SSH specifies the SSH keys that can be used for logging into the user account for which the file is configured. This file is usually found in the user's home directory under<user-home>/.ssh/authorized_keys.[1]Users may edit the system’s SSH config file to modify the directives PubkeyAuthentication and RSAAuthentication to the value "yes" to ensure public key and RSA authentication are enabled. The SSH config file is usually located under/etc/ssh/sshd_config.Adversaries may modify SSHauthorized_keysfiles directly with scripts or shell commands to add their own adversary-supplied public keys. In cloud environments, adversaries may be able to modify the SSH authorized_keys file of a particular virtual machine via the command line interface or rest API. For example, by using the Google Cloud CLI’s "add-metadata" command an adversary may add SSH keys to a user account.[2][3]Similarly, in Azure, an adversary may update the authorized_keys file of a virtual machine via a PATCH request to the API.[4]This ensures that an adversary possessing the corresponding private key may log in as an existing user via SSH.[5][6]It may also lead to privilege escalation where the virtual machine or instance has distinct permissions from the requesting user.Where authorized_keys files are modified via cloud APIs or command line interfaces, an adversary may achieve privilege escalation on the target virtual machine if they add a key to a higher-privileged user.SSH keys can also be added to accounts on network devices, such as with theip ssh pubkey-chainNetwork Device CLIcommand.[7]ID:T1098.004Sub-technique of:T1098ⓘTactics:Persistence,Privilege EscalationⓘPlatforms:IaaS, Linux, Network, macOSContributors:Arad Inbar, Fidelis Security; Austin Clark, @c2defense; Dror Alon, Palo Alto Networks; Or Kliger, Palo Alto Networks; Tony Lambert, Red CanaryVersion:1.3Created:24 June 2020Last Modified:03 October 2023Version PermalinkLive VersionProcedure ExamplesIDNameDescriptionS0482BundloreBundlorecreates a new key pair withssh-keygenand drops the newly created user key inauthorized_keysto enable remote login.[8]G1006Earth LuscaEarth Luscahas dropped an SSH-authorized key in the/root/.sshfolder in order to access a compromised server with SSH.[9]S0468SkidmapSkidmaphas the ability to add the public key of its handlers to theauthorized_keysfile to maintain persistence on an infected host.[10]G0139TeamTNTTeamTNThas added RSA keys inauthorized_keys.[11][12]S0658XCSSETXCSSETwill create an ssh key if necessary with thessh-keygen -t rsa -f $HOME/.ssh/id_rsa -Pcommand.XCSSETwill upload a private key file to the server to remotely access the host without a password.[13]MitigationsIDMitigationDescriptionM1042Disable or Remove Feature or ProgramDisable SSH if it is not necessary on a host or restrict SSH access for specific users/groups using/etc/ssh/sshd_config.M1022Restrict File and Directory PermissionsRestrict access to theauthorized_keysfile.M1018User Account ManagementIn cloud environments, ensure that only users who explicitly require the permissions to update instance metadata or configurations can do so.DetectionIDData SourceData ComponentDetectsDS0017CommandCommand ExecutionMonitor executed commands and arguments to modify the authorized_keys or /etc/ssh/sshd_config files.DS0022FileFile ModificationMonitor for changes made to detect changes made to the authorized_keys file for each user on a system. Monitor for changes to and suspicious processes modifiying /etc/ssh/sshd_config.DS0009ProcessProcess CreationMonitor for suspicious processes modifying the authorized_keys or /etc/ssh/sshd_config files.Referencesssh.com. (n.d.). Authorized_keys File in SSH. Retrieved June 24, 2020.Google Cloud. (2022, March 31). gcloud compute instances add-metadata. Retrieved April 1, 2022.Chris Moberly. (2020, February 12). Tutorial on privilege escalation and post exploitation tactics in Google Cloud Platform environments. Retrieved April 1, 2022.Microsoft. (n.d.). Virtual Machines - Update. Retrieved April 1, 2022.Blachman, Y. (2020, April 22). Growing Abuse of SSH Keys: Commodity Malware Campaigns Now Equipped with SSH Capabilities. Retrieved June 24, 2020.Cybereason Nocturnus. (2019, June 13). New Pervasive Worm Exploiting Linux Exim Server Vulnerability. Retrieved June 24, 2020.Cisco. (2021, August 23). ip ssh pubkey-chain. Retrieved July 13, 2022.Sushko, O. (2019, April 17). macOS Bundlore: Mac Virus Bypassing macOS Security Features. Retrieved June 30, 2020.Chen, J., et al. (2022). Delving Deep: An Analysis of Earth Lusca’s Operations. Retrieved July 1, 2022.Remillano, A., Urbanec, J. (2019, September 19). Skidmap Linux Malware Uses Rootkit Capabilities to Hide Cryptocurrency-Mining Payload. Retrieved June 4, 2020.Kol, Roi. Morag, A. (2020, August 25). Deep Analysis of TeamTNT Techniques Using Container Images to Attack. Retrieved September 22, 2021.Darin Smith. (2022, April 21). TeamTNT targeting AWS, Alibaba. Retrieved August 4, 2022.Mac Threat Response, Mobile Research Team. (2020, August 13). The XCSSET Malware: Inserts Malicious Code Into Xcode Projects, Performs UXSS Backdoor Planting in Safari, and Leverages Two Zero-day Exploits. Retrieved October 5, 2021.×load more resultsContact UsTerms of UsePrivacy PolicyWebsite Changelog© 2015 - 2024, The MITRE Corporation. MITRE ATT&CK and ATT&CK are registered trademarks of The MITRE Corporation.