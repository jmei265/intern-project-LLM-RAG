MatricesEnterpriseMobileICSTacticsEnterpriseMobileICSTechniquesEnterpriseMobileICSDefensesData SourcesMitigationsEnterpriseMobileICSAssetsCTIGroupsSoftwareCampaignsResourcesGet StartedLearn More about ATT&CKATT&CKconATT&CK Data & ToolsFAQEngage with ATT&CKVersion HistoryLegal & BrandingBenefactorsBlogSearchATT&CKcon 5.0 returns October 22-23, 2024 in McLean, VA.Register heretoday!HomeTechniquesEnterpriseBoot or Logon Autostart ExecutionKernel Modules and ExtensionsBoot or Logon Autostart Execution:Kernel Modules and ExtensionsOther sub-techniques of Boot or Logon Autostart Execution (14)IDNameT1547.001Registry Run Keys / Startup FolderT1547.002Authentication PackageT1547.003Time ProvidersT1547.004Winlogon Helper DLLT1547.005Security Support ProviderT1547.006Kernel Modules and ExtensionsT1547.007Re-opened ApplicationsT1547.008LSASS DriverT1547.009Shortcut ModificationT1547.010Port MonitorsT1547.012Print ProcessorsT1547.013XDG Autostart EntriesT1547.014Active SetupT1547.015Login ItemsAdversaries may modify the kernel to automatically execute programs on system boot. Loadable Kernel Modules (LKMs) are pieces of code that can be loaded and unloaded into the kernel upon demand. They extend the functionality of the kernel without the need to reboot the system. For example, one type of module is the device driver, which allows the kernel to access hardware connected to the system.[1]When used maliciously, LKMs can be a type of kernel-modeRootkitthat run with the highest operating system privilege (Ring 0).[2]Common features of LKM based rootkits include: hiding itself, selective hiding of files, processes and network activity, as well as log tampering, providing authenticated backdoors, and enabling root access to non-privileged users.[3]Kernel extensions, also called kext, are used in macOS to load functionality onto a system similar to LKMs for Linux. Since the kernel is responsible for enforcing security and the kernel extensions run as apart of the kernel, kexts are not governed by macOS security policies. Kexts are loaded and unloaded throughkextloadandkextunloadcommands. Kexts need to be signed with a developer ID that is granted privileges by Apple allowing it to sign Kernel extensions. Developers without these privileges may still sign kexts but they will not load unless SIP is disabled. If SIP is enabled, the kext signature is verified before being added to the AuxKC.[4]Since macOS Catalina 10.15, kernel extensions have been deprecated in favor of System Extensions. However, kexts are still allowed as "Legacy System Extensions" since there is no System Extension for Kernel Programming Interfaces.[5]Adversaries can use LKMs and kexts to conductPersistenceand/orPrivilege Escalationon a system. Examples have been found in the wild, and there are some relevant open source projects as well.[6][7][8][9][10][11][12][13]ID:T1547.006Sub-technique of:T1547ⓘTactics:Persistence,Privilege EscalationⓘPlatforms:Linux, macOSⓘPermissions Required:rootContributors:Anastasios Pingios; Eric Kaiser @ideologysec; Jeremy Galloway; Red Canary; Wayne Silva, F-Secure CounterceptVersion:1.3Created:24 January 2020Last Modified:20 April 2022Version PermalinkLive VersionProcedure ExamplesIDNameDescriptionS0502DrovorubDrovorubcan use kernel modules to establish persistence.[14]C0012Operation CuckooBeesDuringOperation CuckooBees, attackers used a signed kernel rootkit to establish additional persistence.[15]S0468SkidmapSkidmaphas the ability to install several loadable kernel modules (LKMs) on infected machines.[13]MitigationsIDMitigationDescriptionM1049Antivirus/AntimalwareCommon tools for detecting Linux rootkits include: rkhunter[16], chrootkit[17], although rootkits may be designed to evade certain detection tools.M1038Execution PreventionApplication control and software restriction tools, such as SELinux, KSPP, grsecurity MODHARDEN, and Linux kernel tuning can aid in restricting kernel module loading.[18][19][20][21][22]M1026Privileged Account ManagementLimit access to the root account and prevent users from loading kernel modules and extensions through proper privilege separation and limiting Privilege Escalation opportunities.M1018User Account ManagementUse MDM to disable user's ability to install or approve kernel extensions, and ensure all approved kernel extensions are in alignment with policies specified incom.apple.syspolicy.kernel-extension-policy.[23][24]DetectionIDData SourceData ComponentDetectsDS0017CommandCommand ExecutionLoading, unloading, and manipulating modules on Linux systems can be detected by monitoring for the following commands:modprobe,insmod,lsmod,rmmod, ormodinfo[25]Adversaries may run commands on the target system before loading a malicious module in order to ensure that it is properly compiled.[3]Adversaries may also execute commands to identify the exact version of the running Linux kernel and/or download multiple versions of the same .ko (kernel object) files to use the one appropriate for the running system.[13]Many LKMs require Linux headers (specific to the target kernel) in order to compile properly. These are typically obtained through the operating systems package manager and installed like a normal package.On macOS, monitor for execution ofkextloadcommands and user installed kernel extensions performing abnormal and/or potentially malicious activity (such as creating network connections). Monitor for new rows added in thekext_policytable. KextPolicy stores a list of user approved (non Apple) kernel extensions and a partial history of loaded kernel modules in a SQLite database,/var/db/SystemPolicyConfiguration/KextPolicy.[26][27][28]DS0022FileFile CreationMonitor for newly constructed files that may modify the kernel to automatically execute programs on system boot.File ModificationMonitor for changes made to files that may modify the kernel to automatically execute programs on system boot.DS0008KernelKernel Module LoadLKMs are typically loaded into/lib/modulesand have had the extension .ko ("kernel object") since version 2.6 of the Linux kernel.[29]DS0009ProcessProcess CreationMonitor for newly created processes that may modify the kernel to automatically execute programs on system boot.ReferencesPomerantz, O., Salzman, P.. (2003, April 4). The Linux Kernel Module Programming Guide. Retrieved April 6, 2018.Pomerantz, O., Salzman, P. (2003, April 4). Modules vs Programs. Retrieved April 6, 2018.Chuvakin, A. (2003, February). An Overview of Rootkits. Retrieved April 6, 2018.Apple. (n.d.). System and kernel extensions in macOS. Retrieved March 31, 2022.Apple. (n.d.). Deprecated Kernel Extensions and System Extension Alternatives. Retrieved November 4, 2020.Case, A. (2012, October 10). Phalanx 2 Revealed: Using Volatility to Analyze an Advanced Linux Rootkit. Retrieved April 9, 2018.Kurtz, G. (2012, November 19). HTTP iframe Injecting Linux Rootkit. Retrieved December 21, 2017.Augusto, I. (2018, March 8). Reptile - LMK Linux rootkit. Retrieved April 9, 2018.Mello, V. (2018, March 8). Diamorphine - LMK rootkit for Linux Kernels 2.6.x/3.x/4.x (x86 and x86_64). Retrieved April 9, 2018.Wardle, P. (2015, April). Malware Persistence on OS X Yosemite. Retrieved April 6, 2018.Wardle, P. (2017, September 8). High Sierra’s ‘Secure Kernel Extension Loading’ is Broken. Retrieved April 6, 2018.Mikhail, K. (2014, October 16). The Ventir Trojan: assemble your MacOS spy. Retrieved April 6, 2018.Remillano, A., Urbanec, J. (2019, September 19). Skidmap Linux Malware Uses Rootkit Capabilities to Hide Cryptocurrency-Mining Payload. Retrieved June 4, 2020.NSA/FBI. (2020, August). Russian GRU 85th GTsSS Deploys Previously Undisclosed Drovorub Malware. Retrieved August 25, 2020.Cybereason Nocturnus. (2022, May 4). Operation CuckooBees: Deep-Dive into Stealthy Winnti Techniques. Retrieved September 22, 2022.Rootkit Hunter Project. (2018, February 20). The Rootkit Hunter project. Retrieved April 9, 2018.Murilo, N., Steding-Jessen, K. (2017, August 23). Chkrootkit. Retrieved April 9, 2018.Vander Stoep, J. (2016, April 5). [v3] selinux: restrict kernel module loadinglogin  register. Retrieved April 9, 2018.Wikibooks. (2018, August 19). Grsecurity/The RBAC System. Retrieved June 4, 2020.Kernel.org. (2020, February 6). Kernel Self-Protection. Retrieved June 4, 2020.Boelen, M. (2015, October 7). Increase kernel integrity with disabled Linux kernel modules loading. Retrieved June 4, 2020.Pingios, A.. (2018, February 7). LKM loading kernel restrictions. Retrieved June 4, 2020.Apple. (2018, April 19). Technical Note TN2459: User-Approved Kernel Extension Loading. Retrieved June 30, 2020.Apple. (2019, May 3). Configuration Profile Reference, Developer. Retrieved April 15, 2022.Henderson, B. (2006, September 24). How To Insert And Remove LKMs. Retrieved April 9, 2018.Pikeralpha. (2017, August 29). User Approved Kernel Extension Loading…. Retrieved September 23, 2021.Richard Purves. (2017, November 9). MDM and the Kextpocalypse . Retrieved September 23, 2021.Apple. (2019, May 3). Configuration Profile Reference. Retrieved September 23, 2021.Wikipedia. (2018, March 17). Loadable kernel module. Retrieved April 9, 2018.×load more resultsContact UsTerms of UsePrivacy PolicyWebsite Changelog© 2015 - 2024, The MITRE Corporation. MITRE ATT&CK and ATT&CK are registered trademarks of The MITRE Corporation.