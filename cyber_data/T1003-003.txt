MatricesEnterpriseMobileICSTacticsEnterpriseMobileICSTechniquesEnterpriseMobileICSDefensesData SourcesMitigationsEnterpriseMobileICSAssetsCTIGroupsSoftwareCampaignsResourcesGet StartedLearn More about ATT&CKATT&CKconATT&CK Data & ToolsFAQEngage with ATT&CKVersion HistoryLegal & BrandingBenefactorsBlogSearchATT&CKcon 5.0 returns October 22-23, 2024 in McLean, VA.Register heretoday!HomeTechniquesEnterpriseOS Credential DumpingNTDSOS Credential Dumping:NTDSOther sub-techniques of OS Credential Dumping (8)IDNameT1003.001LSASS MemoryT1003.002Security Account ManagerT1003.003NTDST1003.004LSA SecretsT1003.005Cached Domain CredentialsT1003.006DCSyncT1003.007Proc FilesystemT1003.008/etc/passwd and /etc/shadowAdversaries may attempt to access or create a copy of the Active Directory domain database in order to steal credential information, as well as obtain other information about domain members such as devices, users, and access rights. By default, the NTDS file (NTDS.dit) is located in%SystemRoot%\NTDS\Ntds.ditof a domain controller.[1]In addition to looking for NTDS files on active Domain Controllers, adversaries may search for backups that contain the same or similar information.[2]The following tools and techniques can be used to enumerate the NTDS file and the contents of the entire Active Directory hashes.Volume Shadow Copysecretsdump.pyUsing the in-built Windows tool, ntdsutil.exeInvoke-NinjaCopyID:T1003.003Sub-technique of:T1003ⓘTactic:Credential AccessⓘPlatforms:WindowsⓘSystem Requirements:Access to Domain Controller or backupContributors:Ed Williams, Trustwave, SpiderLabsVersion:1.2Created:11 February 2020Last Modified:28 July 2023Version PermalinkLive VersionProcedure ExamplesIDNameDescriptionG0007APT28APT28has used the ntdsutil.exe utility to export the Active Directory database for credential access.[3]G0096APT41APT41used ntdsutil to obtain a copy of the victim environmentntds.ditfile.[4]G0114ChimeraChimerahas gathered the SYSTEM registry and ntds.dit files from target systems.[5]Chimeraspecifically has used the NtdsAudit tool to dump the password hashes of domain users viamsadcs.exe "NTDS.dit" -s "SYSTEM" -p RecordedTV_pdmp.txt --users-csv RecordedTV_users.csvand used ntdsutil to copy the Active Directory database.[6]S0488CrackMapExecCrackMapExeccan dump hashed passwords associated with Active Directory using Windows' Directory Replication Services API (DRSUAPI), or Volume Shadow Copy.[7]C0029Cutting EdgeDuringCutting Edge, threat actors accessed and mounted virtual hard disk backups to extract ntds.dit.[8]G0035DragonflyDragonflyhas dropped and executed SecretsDump to dump password hashes. They also obtained ntds.dit from domain controllers.[9][10]S0404esentutlesentutlcan copyntds.ditusing the Volume Shadow Copy service.[11][12]G1016FIN13FIN13has harvested the NTDS.DIT file and leveraged theImpackettool on the compromised domain controller to locally decrypt it.[13]G0037FIN6FIN6has used Metasploit’sPsExecNTDSGRAB module to obtain a copy of the victim's Active Directory database.[14][15]G0117Fox KittenFox Kittenhas used Volume Shadow Copy to access credential information from NTDS.[16]G0125HAFNIUMHAFNIUMhas stolen copies of the Active Directory database (NTDS.DIT).[17]S0357ImpacketSecretsDump andMimikatzmodules withinImpacketcan perform credential dumping to obtain account and password information from NTDS.dit.[18]G0004Ke3changKe3changhas used NTDSDump and other password dumping tools to gather credentials.[19]S0250KoadicKoadiccan gather hashed passwords by gathering domain controller hashes from NTDS.[20]G1004LAPSUS$LAPSUS$has used Windows built-in toolntdsutilto extract the Active Directory (AD) database.[21]G0045menuPassmenuPasshas used Ntdsutil to dump credentials.[22]G0129Mustang PandaMustang Pandahas used vssadmin to create a volume shadow copy and retrieve the NTDS.dit file.Mustang Pandahas also usedreg saveon the SYSTEM file Registry location to help extract the NTDS.dit file.[23]G0034Sandworm TeamSandworm Teamhas usedntdsutil.exeto back up the Active Directory database, likely for credential access.[24]G1015Scattered SpiderScattered Spiderhas extracted theNTDS.ditfile by creating volume shadow copies of virtual domain controller disks.[25]G1017Volt TyphoonVolt Typhoonhas used ntds.util to create domain controller installation media containing usernames and password hashes.[26][27][28]G0102Wizard SpiderWizard Spiderhas gained access to credentials via exported copies of the ntds.dit Active Directory database.Wizard Spiderhas also created a volume shadow copy and used a batch script file to collect NTDS.dit with the use of the Windows utility, ntdsutil.[29][30]MitigationsIDMitigationDescriptionM1041Encrypt Sensitive InformationEnsure Domain Controller backups are properly secured.[2]M1027Password PoliciesEnsure that local administrator accounts have complex, unique passwords across all systems on the network.M1026Privileged Account ManagementDo not put user or admin domain accounts in the local administrator groups across systems unless they are tightly controlled, as this is often equivalent to having a local administrator account with the same password on all systems. Follow best practices for design and administration of an enterprise network to limit privileged account use across administrative tiers.M1017User TrainingLimit credential overlap across accounts and systems by training users and administrators not to use the same password for multiple accounts.DetectionIDData SourceData ComponentDetectsDS0017CommandCommand ExecutionMonitor executed commands and arguments that may attempt to access or create a copy of the Active Directory domain database in order to steal credential information, as well as obtain other information about domain members such as devices, users, and access rights. Look for command-lines that invoke attempts to access or copy the NTDS.dit.Note: Events 4688 (Microsoft Windows Security Auditing) and 1 (Microsoft Windows Sysmon) provide context of commands and parameters being executed via creation of a new process. Event 800 (PowerShell) provides context of commands and parameters being executed via PowerShell. This detection is based on known Windows utilities commands and parameters that can be used to copy the ntds.dit file. It is recommended to keep the list of commands and parameters up to date.Analytic 1 - Command line attempt to access or create a copy of ntds.dit file((source="WinEventLog:Microsoft-Windows-Powershell/Operational"  EventCode="800") AND((CommandLine LIKE "%ntds%" AND CommandLine LIKE "%ntdsutil%" AND CommandLine LIKE "%create%") OR (CommandLine LIKE "%vssadmin%" AND CommandLine LIKE "%create%" AND CommandLine LIKE "%shadow%") OR (CommandLine LIKE "%copy%" AND CommandLine LIKE "%ntds.dit%")))DS0022FileFile AccessMonitor for access or copy of the NTDS.dit.Note: Events 4656 and 4663 (Microsoft Windows Security Auditing) provide context of processes and users requesting access or accessing file objects (ObjectType = File) such as C:\Windows\NTDS\ntds.dit. It is important to note that, in order to generate these events, a System Access Control List (SACL) must be defined for the ntds.dit file. Access rights that allow read operations on file objects and its attributes are %%4416 Read file data, %%4419 Read extended file attributes, %%4423 Read file attributes. If you search for just the name of the file and not the entire directory, you may get access events related to the ntds.dit file within a snapshot or volume shadow copy.Events 4656 and 4663 (Microsoft Windows Security Auditing) provide context of processes and users creating or copying file objects (ObjectType = File) such as C:\Windows\NTDS\ntds.dit. It is important to note that, in order to generate these events, a System Access Control List (SACL) must be defined for the ntds.dit file. In order to filter file creation events, filter access rigths %%4417 Write data to the file and %%4424 Write file attributes.Event 11 (Microsoft Windows Sysmon) provide context of processes and users creating or copying files. Unfortunately, this event provides context of the file being created or copied, but not the file being copied. A good starting point would be to look for new files created or copied with extension .dit.Analytic 1 - Active Directory Dumping via NTDSUtil(source=WinEventLog:"Security" EventCode IN (4656, 4663)) OR (source=WinEventLog:"Microsoft-Windows-Sysmon/Operational" EventCode="11") ANDObjectType="File" AND TargetFilename="*ntds.dit" AND (AccessList="%%4416" OR AccessList="%%4419" OR AccessList="%%4417" OR AccessList="%%4424")ReferencesWikipedia. (2018, March 10). Active Directory. Retrieved April 11, 2018.Metcalf, S. (2015, January 19). Attackers Can Now Use Mimikatz to Implant Skeleton Key on Domain Controllers & BackDoor Your Active Directory Forest. Retrieved February 3, 2015.NSA, CISA, FBI, NCSC. (2021, July). Russian GRU Conducting Global Brute Force Campaign to Compromise Enterprise and Cloud Environments. Retrieved July 26, 2021.Nikita Rostovcev. (2022, August 18). APT41 World Tour 2021 on a tight schedule. Retrieved February 22, 2024.Cycraft. (2020, April 15). APT Group Chimera - APT Operation Skeleton key Targets Taiwan Semiconductor Vendors. Retrieved August 24, 2020.Jansen, W . (2021, January 12). Abusing cloud services to fly under the radar. Retrieved January 19, 2021.byt3bl33d3r. (2018, September 8). SMB: Command Reference. Retrieved July 17, 2020.Meltzer, M. et al. (2024, January 10). Active Exploitation of Two Zero-Day Vulnerabilities in Ivanti Connect Secure VPN. Retrieved February 27, 2024.US-CERT. (2018, March 16). Alert (TA18-074A): Russian Government Cyber Activity Targeting Energy and Other Critical Infrastructure Sectors. Retrieved June 6, 2018.Core Security. (n.d.). Impacket. Retrieved November 2, 2017.LOLBAS. (n.d.). Esentutl.exe. Retrieved September 3, 2019.Cary, M. (2018, December 6). Locked File Access Using ESENTUTL.exe. Retrieved September 5, 2019.Sygnia Incident Response Team. (2022, January 5). TG2003: ELEPHANT BEETLE UNCOVERING AN ORGANIZED FINANCIAL-THEFT OPERATION. Retrieved February 9, 2023.FireEye Threat Intelligence. (2016, April). Follow the Money: Dissecting the Operations of the Cyber Crime Group FIN6. Retrieved June 1, 2016.McKeague, B. et al. (2019, April 5). Pick-Six: Intercepting a FIN6 Intrusion, an Actor Recently Tied to Ryuk and LockerGoga Ransomware. Retrieved April 17, 2019.CISA. (2020, September 15). Iran-Based Threat Actor Exploits VPN Vulnerabilities. Retrieved December 21, 2020.Gruzweig, J. et al. (2021, March 2). Operation Exchange Marauder: Active Exploitation of Multiple Zero-Day Microsoft Exchange Vulnerabilities. Retrieved March 3, 2021.SecureAuth. (n.d.).  Retrieved January 15, 2019.MSTIC. (2021, December 6). NICKEL targeting government organizations across Latin America and Europe. Retrieved March 18, 2022.Magius, J., et al. (2017, July 19). Koadic. Retrieved June 18, 2018.MSTIC, DART, M365 Defender. (2022, March 24). DEV-0537 Criminal Actor Targeting Organizations for Data Exfiltration and Destruction. Retrieved May 17, 2022.Symantec. (2020, November 17). Japan-Linked Organizations Targeted in Long-Running and Sophisticated Attack Campaign. Retrieved December 17, 2020.Counter Threat Unit Research Team. (2019, December 29). BRONZE PRESIDENT Targets NGOs. Retrieved April 13, 2021.MSTIC. (2022, October 14). New “Prestige” ransomware impacts organizations in Ukraine and Poland. Retrieved January 19, 2023.Microsoft. (2023, October 25). Octo Tempest crosses boundaries to facilitate extortion, encryption, and destruction. Retrieved March 18, 2024.Microsoft Threat Intelligence. (2023, May 24). Volt Typhoon targets US critical infrastructure with living-off-the-land techniques. Retrieved July 27, 2023.NSA et al. (2023, May 24). People's Republic of China State-Sponsored Cyber Actor Living off the Land to Evade Detection. Retrieved July 27, 2023.Counter Threat Unit Research Team. (2023, May 24). Chinese Cyberespionage Group BRONZE SILHOUETTE Targets U.S. Government and Defense Organizations. Retrieved July 27, 2023.Kimberly Goody, Jeremy Kennelly, Joshua Shilko, Steve Elovitz, Douglas Bienstock. (2020, October 28). Unhappy Hour Special: KEGTAP and SINGLEMALT With a Ransomware Chaser. Retrieved October 28, 2020.Shilko, J., et al. (2021, October 7). FIN12: The Prolific Ransomware Intrusion Threat Actor That Has Aggressively Pursued Healthcare Targets. Retrieved June 15, 2023.×load more resultsContact UsTerms of UsePrivacy PolicyWebsite Changelog© 2015 - 2024, The MITRE Corporation. MITRE ATT&CK and ATT&CK are registered trademarks of The MITRE Corporation.