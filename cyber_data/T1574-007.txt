MatricesEnterpriseMobileICSTacticsEnterpriseMobileICSTechniquesEnterpriseMobileICSDefensesData SourcesMitigationsEnterpriseMobileICSAssetsCTIGroupsSoftwareCampaignsResourcesGet StartedLearn More about ATT&CKATT&CKconATT&CK Data & ToolsFAQEngage with ATT&CKVersion HistoryLegal & BrandingBenefactorsBlogSearchATT&CKcon 5.0 returns October 22-23, 2024 in McLean, VA.Register heretoday!HomeTechniquesEnterpriseHijack Execution FlowPath Interception by PATH Environment VariableHijack Execution Flow:Path Interception by PATH Environment VariableOther sub-techniques of Hijack Execution Flow (13)IDNameT1574.001DLL Search Order HijackingT1574.002DLL Side-LoadingT1574.004Dylib HijackingT1574.005Executable Installer File Permissions WeaknessT1574.006Dynamic Linker HijackingT1574.007Path Interception by PATH Environment VariableT1574.008Path Interception by Search Order HijackingT1574.009Path Interception by Unquoted PathT1574.010Services File Permissions WeaknessT1574.011Services Registry Permissions WeaknessT1574.012COR_PROFILERT1574.013KernelCallbackTableT1574.014AppDomainManagerAdversaries may execute their own malicious payloads by hijacking environment variables used to load libraries. The PATH environment variable contains a list of directories (User and System) that the OS searches sequentially through in search of the binary that was called from a script or the command line.Adversaries can place a malicious program in an earlier entry in the list of directories stored in the PATH environment variable, resulting in the operating system executing the malicious binary rather than the legitimate binary when it searches sequentially through that PATH listing.For example, on Windows if an adversary places a malicious program named "net.exe" inC:\example path, which by default precedesC:\Windows\system32\net.exein the PATH environment variable, when "net" is executed from the command-line theC:\example pathwill be called instead of the system's legitimate executable atC:\Windows\system32\net.exe. Some methods of executing a program rely on the PATH environment variable to determine the locations that are searched when the path for the program is not given, such as executing programs from aCommand and Scripting Interpreter.[1]Adversaries may also directly modify the $PATH variable specifying the directories to be searched.  An adversary can modify the$PATHvariable to point to a directory they have write access. When a program using the $PATH variable is called, the OS searches the specified directory and executes the malicious binary. On macOS, this can also be performed through modifying the $HOME variable. These variables can be modified using the command-line, launchctl,Unix Shell Configuration Modification, or modifying the/etc/paths.dfolder contents.[2][3][4]ID:T1574.007Sub-technique of:T1574ⓘTactics:Persistence,Privilege Escalation,Defense EvasionⓘPlatforms:Linux, Windows, macOSⓘDefense Bypassed:Application ControlContributors:Stefan KanthakVersion:1.1Created:13 March 2020Last Modified:03 October 2023Version PermalinkLive VersionProcedure ExamplesIDNameDescriptionS1111DarkGateDarkGateoverrides the%windir%environment variable by setting a Registry key,HKEY_CURRENT_User\Environment\windir, to an alternate command to execute a malicious AutoIt script. This allowsDarkGateto run every time the scheduled taskDiskCleanupis executed as this uses the path value%windir%\system32\cleanmgr.exefor execution.[5]S0363EmpireEmpirecontains modules that can discover and exploit path interception opportunities in the PATH environment variable.[6]S0194PowerSploitPowerSploitcontains a collection of Privesc-PowerUp modules that can discover and exploit path interception opportunities in the PATH environment variable.[7][8]MitigationsIDMitigationDescriptionM1047AuditFind and eliminate path interception weaknesses in program configuration files, scripts, the PATH environment variable, services, and in shortcuts by surrounding PATH variables with quotation marks when functions allow for them. Be aware of the search order Windows uses for executing or loading binaries and use fully qualified paths wherever appropriate.Clean up old Windows Registry keys when software is uninstalled to avoid keys with no associated legitimate binaries. Periodically search for and correct or report path interception weaknesses on systems that may have been introduced using custom or available tools that report software using insecure path configurations.[9][10][11]M1038Execution PreventionAdversaries will likely need to place new binaries in locations to be executed through this weakness. Identify and block potentially malicious software executed path interception by using application control tools, like Windows Defender Application Control, AppLocker, or Software Restriction Policies where appropriate.[12][13][14][15][16][17]M1022Restrict File and Directory PermissionsEnsure that proper permissions and directory access control are set to deny users the ability to write files to the top-level directoryC:and system directories, such asC:\Windows\, to reduce places where malicious files could be placed for execution. Require that all executables be placed in write-protected directories.DetectionIDData SourceData ComponentDetectsDS0022FileFile CreationMonitor for newly constructed files for files named after partial directories and in locations that may be searched for common processes through the environment variable, or otherwise should not be user writable. Also, monitor file creation for programs that are named after Windows system programs or programs commonly executed without a path (such as "findstr," "net," and "python"). If this activity occurs outside of known administration activity, upgrades, installations, or patches, then it may be suspicious.DS0009ProcessProcess CreationMonitor for newly executed processes for process executable paths that are named for partial directories.DS0024Windows RegistryWindows Registry Key ModificationMonitor for modifications of PATH environment variable Registry keys such asHKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\Environment\Path. An adversary can add a new directory or list of directories before other locations where programs can be executed from.ReferencesExpressVPN Security Team. (2021, November 16). Cybersecurity lessons: A PATH vulnerability in Windows. Retrieved September 28, 2023.Nischay Hegde and Siddartha Malladi. (2023, July 12). PoC Exploit: Fake Proof of Concept with Backdoor Malware. Retrieved September 28, 2023.Vivek Gite. (2023, August 22). MacOS – Set / Change $PATH Variable Command. Retrieved September 28, 2023.Elastic Security 7.17. (2022, February 1). Modification of Environment Variable via Launchctl. Retrieved September 28, 2023.Adi Zeligson & Rotem Kerner. (2018, November 13). Enter The DarkGate - New Cryptocurrency Mining and Ransomware Campaign. Retrieved February 9, 2024.Schroeder, W., Warner, J., Nelson, M. (n.d.). Github PowerShellEmpire. Retrieved April 28, 2016.PowerShellMafia. (2012, May 26). PowerSploit - A PowerShell Post-Exploitation Framework. Retrieved February 6, 2018.PowerSploit. (n.d.). PowerSploit. Retrieved February 6, 2018.Microsoft. (n.d.). CreateProcess function. Retrieved December 5, 2014.Microsoft. (n.d.). Dynamic-Link Library Security. Retrieved July 25, 2016.Kanthak, S.. (2016, July 20). Vulnerability and Exploit Detector. Retrieved February 3, 2017.Beechey, J.. (2014, November 18). Application Whitelisting:  Panacea or Propaganda?. Retrieved November 18, 2014.Gorzelany, A., Hall, J., Poggemeyer, L.. (2019, January 7). Windows Defender Application Control. Retrieved July 16, 2019.Tomonaga, S. (2016, January 26). Windows Commands Abused by Attackers. Retrieved February 2, 2016.NSA Information Assurance Directorate. (2014, August). Application Whitelisting Using Microsoft AppLocker. Retrieved March 31, 2016.Corio, C., & Sayana, D. P.. (2008, June). Application Lockdown with Software Restriction Policies. Retrieved November 18, 2014.Microsoft. (2012, June 27). Using Software Restriction Policies and AppLocker Policies. Retrieved April 7, 2016.×load more resultsContact UsTerms of UsePrivacy PolicyWebsite Changelog© 2015 - 2024, The MITRE Corporation. MITRE ATT&CK and ATT&CK are registered trademarks of The MITRE Corporation.