MatricesEnterpriseMobileICSTacticsEnterpriseMobileICSTechniquesEnterpriseMobileICSDefensesData SourcesMitigationsEnterpriseMobileICSAssetsCTIGroupsSoftwareCampaignsResourcesGet StartedLearn More about ATT&CKATT&CKconATT&CK Data & ToolsFAQEngage with ATT&CKVersion HistoryLegal & BrandingBenefactorsBlogSearchATT&CKcon 5.0 returns October 22-23, 2024 in McLean, VA.Register heretoday!HomeTechniquesEnterpriseSubvert Trust ControlsGatekeeper BypassSubvert Trust Controls:Gatekeeper BypassOther sub-techniques of Subvert Trust Controls (6)IDNameT1553.001Gatekeeper BypassT1553.002Code SigningT1553.003SIP and Trust Provider HijackingT1553.004Install Root CertificateT1553.005Mark-of-the-Web BypassT1553.006Code Signing Policy ModificationAdversaries may modify file attributes and subvert Gatekeeper functionality to evade user prompts and execute untrusted programs. Gatekeeper is a set of technologies that act as layer of Apple’s security model to ensure only trusted applications are executed on a host. Gatekeeper was built on top of File Quarantine in Snow Leopard (10.6, 2009) and has grown to include Code Signing, security policy compliance, Notarization, and more. Gatekeeper also treats applications running for the first time differently than reopened applications.[1][2]Based on an opt-in system, when files are downloaded an extended attribute (xattr) calledcom.apple.quarantine(also known as a quarantine flag) can be set on the file by the application performing the download. Launch Services opens the application in a suspended state. For first run applications with the quarantine flag set, Gatekeeper executes the following functions:Checks extended attribute – Gatekeeper checks for the quarantine flag, then provides an alert prompt to the user to allow or deny execution.[3][4]Checks System Policies - Gatekeeper checks the system security policy, allowing execution of apps downloaded from either just the App Store or the App Store and identified developers.Code Signing – Gatekeeper checks for a valid code signature from an Apple Developer ID.Notarization - Using theapi.apple-cloudkit.comAPI, Gatekeeper reaches out to Apple servers to verify or pull down the notarization ticket and ensure the ticket is not revoked. Users can override notarization, which will result in a prompt of executing an "unauthorized app" and the security policy will be modified.Adversaries can subvert one or multiple security controls within Gatekeeper checks through logic errors (e.g.Exploitation for Defense Evasion), unchecked file types, and external libraries. For example, prior to macOS 13 Ventura, code signing and notarization checks were only conducted on first launch, allowing adversaries to write malicious executables to previously opened applications in order to bypass Gatekeeper security checks.[5][6]Applications and files loaded onto the system from a USB flash drive, optical disk, external hard drive, from a drive shared over the local network, or using the curl command may not set the quarantine flag. Additionally, it is possible to avoid setting the quarantine flag usingDrive-by Compromise.ID:T1553.001Sub-technique of:T1553ⓘTactic:Defense EvasionⓘPlatforms:macOSⓘDefense Bypassed:Anti-virus, Application ControlContributors:Brandon Dalton @PartyD0lphin; Swasti Bhushan Deb, IBM India Pvt. Ltd.Version:1.2Created:05 February 2020Last Modified:21 October 2022Version PermalinkLive VersionProcedure ExamplesIDNameDescriptionS0369CoinTickerCoinTickerdownloads the EggShell mach-o binary using curl, which does not set the quarantine flag.[7]S1016MacMaMacMahas removed thecom.apple.quarantineattributefrom the dropped file,$TMPDIR/airportpaird.[8]S0402OSX/ShlayerIf running with elevated privileges,OSX/Shlayerhas used thespctlcommand to disable Gatekeeper protection for a downloaded file.OSX/Shlayercan also leverage system links pointing to bash scripts in the downloaded DMG file to bypass Gatekeeper, a flaw patched in macOS 11.3 and later versions.OSX/Shlayerhas been Notarized by Apple, resulting in successful passing of additional Gatekeeper checks.[9][10][11]S0352OSX_OCEANLOTUS.DOSX_OCEANLOTUS.Duses the commandxattr -d com.apple.quarantineto remove the quarantine file attribute used by Gatekeeper.[12][4]S0658XCSSETXCSSEThas dropped a malicious applet into an app's.../Contents/MacOS/folder of a previously launched app to bypass Gatekeeper's security checks on first launch apps (prior to macOS 13).[6]MitigationsIDMitigationDescriptionM1038Execution PreventionSystem settings can prevent applications from running that haven't been downloaded through the Apple Store which can help mitigate some of these issues.DetectionIDData SourceData ComponentDetectsDS0017CommandCommand ExecutionMonitor and investigate attempts to modify extended file attributes with utilities such asxattr. Built-in system utilities may generate high false positive alerts, so compare against baseline knowledge for how systems are typically used and correlate modification events with other indications of malicious activity where possible.DS0022FileFile MetadataReviewfalsevalues under theLSFileQuarantineEnabledentry in an application'sInfo.plistfile (required by every application).falseunderLSFileQuarantineEnabledindicates that an application does not use the quarantine flag. Unsandboxed applications with an unspecifiedLSFileQuarantineEnabledentry will default to not setting the quarantine flag.QuarantineEvents is a SQLite database containing a list of all files assigned thecom.apple.quarantineattribute, located at~/Library/Preferences/com.apple.LaunchServices.QuarantineEventsV2. Each event contains the corresponding UUID, timestamp, application, Gatekeeper score, and decision if it was allowed.[1]File ModificationThe removal of thecom.apple.quarantineflag by a user instead of the operating system is a suspicious action and should be examined further. Also monitor software update frameworks that may strip this flag when performing updates.DS0009ProcessProcess CreationMonitor and investigate attempts to modify extended file attributes with utilities such asxattr. Built-in system utilities may generate high false positive alerts, so compare against baseline knowledge for how systems are typically used and correlate modification events with other indications of malicious activity where possible.Referenceshoakley. (2020, October 29). Quarantine and the quarantine flag. Retrieved September 13, 2021.How Notarization Works. (2020, August 28). How notarization works. Retrieved September 13, 2021.Eddie Lee. (2016, February 17). OceanLotus for OS X - an Application Bundle Pretending to be an Adobe Flash Update. Retrieved July 5, 2017.Phil Stokes. (2021, February 16). 20 Common Tools & Techniques Used by macOS Threat Actors & Malware. Retrieved August 23, 2021.Csaba Fitzl. (2021, June 29). GateKeeper - Not a Bypass (Again). Retrieved September 22, 2021.Brandon Dalton. (2022, August 9). A bundle of nerves: Tweaking macOS security controls to thwart application bundle manipulation. Retrieved September 27, 2022.Thomas Reed. (2018, October 29). Mac cryptocurrency ticker app installs backdoors. Retrieved April 23, 2019.M.Léveillé, M., Cherepanov, A.. (2022, January 25). Watering hole deploys new macOS malware, DazzleSpy, in Asia. Retrieved May 6, 2022.Carbon Black Threat Analysis Unit. (2019, February 12). New macOS Malware Variant of Shlayer (OSX) Discovered. Retrieved August 8, 2019.Jaron Bradley. (2021, April 26). Shlayer malware abusing Gatekeeper bypass on macOS. Retrieved September 22, 2021.Patrick Wardle. (2020, August 30). Apple Approved Malware malicious code ...now notarized!? #2020. Retrieved September 13, 2021.Magisa, L. (2020, November 27). New MacOS Backdoor Connected to OceanLotus Surfaces. Retrieved December 2, 2020.×load more resultsContact UsTerms of UsePrivacy PolicyWebsite Changelog© 2015 - 2024, The MITRE Corporation. MITRE ATT&CK and ATT&CK are registered trademarks of The MITRE Corporation.