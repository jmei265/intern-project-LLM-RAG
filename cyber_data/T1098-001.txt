MatricesEnterpriseMobileICSTacticsEnterpriseMobileICSTechniquesEnterpriseMobileICSDefensesData SourcesMitigationsEnterpriseMobileICSAssetsCTIGroupsSoftwareCampaignsResourcesGet StartedLearn More about ATT&CKATT&CKconATT&CK Data & ToolsFAQEngage with ATT&CKVersion HistoryLegal & BrandingBenefactorsBlogSearchATT&CKcon 5.0 returns October 22-23, 2024 in McLean, VA.Register heretoday!HomeTechniquesEnterpriseAccount ManipulationAdditional Cloud CredentialsAccount Manipulation:Additional Cloud CredentialsOther sub-techniques of Account Manipulation (6)IDNameT1098.001Additional Cloud CredentialsT1098.002Additional Email Delegate PermissionsT1098.003Additional Cloud RolesT1098.004SSH Authorized KeysT1098.005Device RegistrationT1098.006Additional Container Cluster RolesAdversaries may add adversary-controlled credentials to a cloud account to maintain persistent access to victim accounts and instances within the environment.For example, adversaries may add credentials for Service Principals and Applications in addition to existing legitimate credentials in Azure AD.[1][2][3]These credentials include both x509 keys and passwords.[1]With sufficient permissions, there are a variety of ways to add credentials including the Azure Portal, Azure command line interface, and Azure or Az PowerShell modules.[4]In infrastructure-as-a-service (IaaS) environments, after gaining access throughCloud Accounts, adversaries may generate or import their own SSH keys using either theCreateKeyPairorImportKeyPairAPI in AWS or thegcloud compute os-login ssh-keys addcommand in GCP.[5]This allows persistent access to instances within the cloud environment without further usage of the compromised cloud accounts.[6][7]Adversaries may also use theCreateAccessKeyAPI in AWS or thegcloud iam service-accounts keys createcommand in GCP to add access keys to an account. If the target account has different permissions from the requesting account, the adversary may also be able to escalate their privileges in the environment (i.e.Cloud Accounts).[8][9]For example, in Azure AD environments, an adversary with the Application Administrator role can add a new set of credentials to their application's service principal. In doing so the adversary would be able to access the service principal’s roles and permissions, which may be different from those of the Application Administrator.[10]In AWS environments, adversaries with the appropriate permissions may also use thests:GetFederationTokenAPI call to create a temporary set of credentials toForge Web Credentialstied to the permissions of the original user account. These temporary credentials may remain valid for the duration of their lifetime even if the original account’s API credentials are deactivated.[11]ID:T1098.001Sub-technique of:T1098ⓘTactics:Persistence,Privilege EscalationⓘPlatforms:Azure AD, IaaS, SaaSContributors:Alex Soler, AttackIQ; Arad Inbar, Fidelis Security; Dylan Silva, AWS Security; Expel; Jannie Li, Microsoft Threat Intelligence Center (MSTIC); Oleg Kolesnikov, Securonix; Zur Ulianitzky, XM CyberVersion:2.7Created:19 January 2020Last Modified:28 February 2024Version PermalinkLive VersionProcedure ExamplesIDNameDescriptionC0027C0027DuringC0027,Scattered Spiderused aws_consoler  to create temporary federated credentials for fake users in order to obfuscate which AWS credential is compromised and enable pivoting from the AWS CLI to console sessions without MFA.[12]S1091PacuPacucan generate SSH and API keys for AWS infrastructure and additional API keys for other IAM users.[13]C0024SolarWinds CompromiseDuring theSolarWinds Compromise,APT29added credentials to OAuth Applications and Service Principals.[14][15]MitigationsIDMitigationDescriptionM1032Multi-factor AuthenticationUse multi-factor authentication for user and privileged accounts. Consider enforcing multi-factor authentication for theCreateKeyPairandImportKeyPairAPI calls through IAM policies.[6]M1030Network SegmentationConfigure access controls and firewalls to limit access to critical systems and domain controllers. Most cloud environments support separate virtual private cloud (VPC) instances that enable further segmentation of cloud systems.M1026Privileged Account ManagementDo not allow domain administrator or root accounts to be used for day-to-day operations that may expose them to potential adversaries on unprivileged systems.M1018User Account ManagementEnsure that low-privileged user accounts do not have permission to add access keys to accounts. In AWS environments, prohibit users from calling thests:GetFederationTokenAPI unless explicitly required.[11]DetectionIDData SourceData ComponentDetectsDS0002User AccountUser Account ModificationMonitor for unexpected changes to cloud user accounts, such as Azure Activity Logs highlighting malicious Service Principal and Application modifications.Monitor for the use of API and CLI commands that add access keys or tokens to accounts, such asCreateAccessKeyorGetFederationTokenin AWS orservice-accounts keys createin GCP. Also monitor for the usage of APIs that create or import SSH keys, particularly by unexpected users or accounts such as the root account.ReferencesMSRC. (2020, December 13). Customer Guidance on Recent Nation-State Cyber Attacks. Retrieved December 17, 2020.Kunz, Bryce. (2018, May 11). Blue Cloud of Death: Red Teaming Azure. Retrieved October 23, 2019.Kunz, Bruce. (2018, October 14). Blue Cloud of Death: Red Teaming Azure. Retrieved November 21, 2019.Bellavance, Ned. (2019, July 16). Demystifying Azure AD Service Principals. Retrieved January 19, 2020.Google. (n.d.). gcloud compute os-login ssh-keys add. Retrieved October 1, 2020.A. Randazzo, B. Manahan and S. Lipton. (2020, April 28). Finding Evil in AWS. Retrieved June 25, 2020.S. Lipton, L. Easterly, A. Randazzo and J. Hencinski. (2020, July 28). Behind the scenes in the Expel SOC: Alert-to-fix in AWS. Retrieved October 1, 2020.Spencer Gietzen. (n.d.). AWS IAM Privilege Escalation – Methods and Mitigation. Retrieved May 27, 2022.SCARLETEEL 2.0: Fargate, Kubernetes, and Crypto. (2023, July 11). SCARLETEEL 2.0: Fargate, Kubernetes, and Crypto. Retrieved July 12, 2023.Andy Robbins. (2021, October 12). Azure Privilege Escalation via Service Principal Abuse. Retrieved April 1, 2022.Vaishnav Murthy and Joel Eng. (2023, January 30). How Adversaries Can Persist with AWS User Federation. Retrieved March 10, 2023.Parisi, T. (2022, December 2). Not a SIMulation: CrowdStrike Investigations Reveal Intrusion Campaign Targeting Telco and BPO Companies. Retrieved June 30, 2023.Rhino Security Labs. (2019, August 22). Pacu. Retrieved October 17, 2019.MSRC. (2020, December 13). Customer Guidance on Recent Nation-State Cyber Attacks. Retrieved December 30, 2020.CrowdStrike. (2022, January 27). Early Bird Catches the Wormhole: Observations from the StellarParticle Campaign. Retrieved February 7, 2022.×load more resultsContact UsTerms of UsePrivacy PolicyWebsite Changelog© 2015 - 2024, The MITRE Corporation. MITRE ATT&CK and ATT&CK are registered trademarks of The MITRE Corporation.