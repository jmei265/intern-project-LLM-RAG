MatricesEnterpriseMobileICSTacticsEnterpriseMobileICSTechniquesEnterpriseMobileICSDefensesData SourcesMitigationsEnterpriseMobileICSAssetsCTIGroupsSoftwareCampaignsResourcesGet StartedLearn More about ATT&CKATT&CKconATT&CK Data & ToolsFAQEngage with ATT&CKVersion HistoryLegal & BrandingBenefactorsBlogSearchATT&CKcon 5.0 returns October 22-23, 2024 in McLean, VA.Register heretoday!HomeTechniquesEnterpriseScheduled Task/JobAtScheduled Task/Job:AtOther sub-techniques of Scheduled Task/Job (5)IDNameT1053.002AtT1053.003CronT1053.005Scheduled TaskT1053.006Systemd TimersT1053.007Container Orchestration JobAdversaries may abuse theatutility to perform task scheduling for initial or recurring execution of malicious code. Theatutility exists as an executable within Windows, Linux, and macOS for scheduling tasks at a specified time and date. Although deprecated in favor ofScheduled Task'sschtasksin Windows environments, usingatrequires that the Task Scheduler service be running, and the user to be logged on as a member of the local Administrators group.On Linux and macOS,atmay be invoked by the superuser as well as any users added to theat.allowfile. If theat.allowfile does not exist, theat.denyfile is checked. Every username not listed inat.denyis allowed to invokeat. If theat.denyexists and is empty, global use ofatis permitted. If neither file exists (which is often the baseline) only the superuser is allowed to useat.[1]Adversaries may useatto execute programs at system startup or on a scheduled basis forPersistence.atcan also be abused to conduct remoteExecutionas part ofLateral Movementand/or to run a process under the context of a specified account (such as SYSTEM).In Linux environments, adversaries may also abuseatto break out of restricted environments by using a task to spawn an interactive system shell or to run system commands. Similarly,atmay also be used forPrivilege Escalationif the binary is allowed to run as superuser viasudo.[2]ID:T1053.002Sub-technique of:T1053ⓘTactics:Execution,Persistence,Privilege EscalationⓘPlatforms:Linux, Windows, macOSⓘPermissions Required:Administrator, UserⓘSupports Remote:YesVersion:2.2Created:27 November 2019Last Modified:15 November 2023Version PermalinkLive VersionProcedure ExamplesIDNameDescriptionG0026APT18APT18actors used the nativeatWindows task scheduler tool to use scheduled tasks for execution on a victim network.[3]S0110atatcan be used to schedule a task on a system to be executed at a specific date or time.[4][1]G0060BRONZE BUTLERBRONZE BUTLERhas usedatto register a scheduled task to execute malware during lateral movement.[5]S0488CrackMapExecCrackMapExeccan set a scheduled task on the target system to execute commands remotely usingat.[6]S0233MURKYTOPMURKYTOPhas the capability to schedule remote AT jobs.[7]G0027Threat Group-3390Threat Group-3390actors useatto schedule tasks to run self-extracting RAR archives, which installHTTPBrowserorPlugXon other victims on a network.[8]MitigationsIDMitigationDescriptionM1047AuditToolkits like the PowerSploit framework contain PowerUp modules that can be used to explore systems for permission weaknesses in scheduled tasks that could be used to escalate privileges.[9]Windows operating system also creates a registry key specifically associated with the creation of a scheduled task on the destination host at: Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tree\At1.[10]In Linux and macOS environments, scheduled tasks usingatcan be audited locally, or through centrally collected logging, using syslog, or auditd events from the host.[11]M1028Operating System ConfigurationConfigure settings for scheduled tasks to force tasks to run under the context of the authenticated account instead of allowing them to run as SYSTEM. The associated Registry key is located atHKLM\SYSTEM\CurrentControlSet\Control\Lsa\SubmitControl. The setting can be configured through GPO: Computer Configuration > [Policies] > Windows Settings > Security Settings > Local Policies > Security Options: Domain Controller: Allow server operators to schedule tasks, set to disabled.[12]M1026Privileged Account ManagementConfigure the Increase Scheduling Priority option to only allow the Administrators group the rights to schedule a priority process. This can be configured through GPO: Computer Configuration > [Policies] > Windows Settings > Security Settings > Local Policies > User Rights Assignment: Increase scheduling priority.[13]M1018User Account ManagementLimit privileges of user accounts and remediate Privilege Escalation vectors so only authorized administrators can create scheduled tasks on remote systems. In Linux environments, users account-level access toatcan be managed usingat.allowandat.denyfiles. Users listed in the at.allow are enabled to schedule actions using at, whereas users listed in at.deny file disabled from the utility.DetectionIDData SourceData ComponentDetectsDS0017CommandCommand ExecutionMonitor executed commands and arguments for actions that could be taken to create/modify tasks. Tasks may also be created through Windows system management tools such asWindows Management InstrumentationandPowerShell, so additional logging may need to be configured to gather the appropriate data.DS0022FileFile ModificationOn Windows, monitor Windows Task Scheduler stores in%systemroot%\System32\Tasksfor change entries related to scheduled tasks, especially those that do not correlate with known software, patch cycles, etc. On Linux and macOS, allatjobs are stored in/var/spool/cron/atjobs/.[14]DS0029Network TrafficNetwork Traffic FlowMonitor network data for uncommon data flows. Processes utilizing the network that do not normally have network communication or have never been seen before are suspicious. When AT.exe is used to remotely schedule tasks, Windows uses named pipes over SMB to communicate with the API on the remote machine. After authentication over SMB, the Named PipeATSVCis opened, over which the JobAdd function is called. On the remote host, the job files are created by the Task Scheduler and follow the conventionC:\Windows\System32\AT.This pipe activity could be discovered with a network decoder, such as that in wireshark, that can inspect SMB traffic to identify the use of pipes. It could also be detected by looking for raw packet capture streams or from a custom sensor on the host that hooks the appropriate API functions. If no network or API level of visibility is possible, this traffic may inferred by looking at SMB connections over 445/tcp followed by the creation of files matching the patternC:\Windows\System32\AT\<job_id>.To detect AT via network traffic, a sensor is needed that has the ability to extract and decode PCAP information. Specifically, it needs to properly decode SMB and the functions that are implemented over it via NamedPipes. If a sensor meets these criteria, then the PCAP data needs to search for instances of the commandJobAddover the pipeATSVC, which is all implemented over Windows SMB 445/tcp.Analytic 1 - Remotely Scheduled Tasks via ATsource="Zeek:" (dest_port=445 AND proto_info.pipe="ATSVC") AND (proto_info.function="JobAdd")DS0009ProcessProcess CreationMonitor for newly constructed processes with command-lines that create/modify or are executed from tasks. For example, on Windows tasks may spawn fromsvchost.exeor the Windows Task Schedulertaskeng.exefor older OS versions.[15]Suspicious program execution through scheduled tasks may show up as outlier processes that have not been seen before when compared against historical data. Instances of the process at.exe running imply the querying or creation of tasks. Although the command_line is not essential for the analytic to run, it is critical when identifying the command that was scheduled.Analytic 1 - Scheduled Task(source="WinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode="1") OR (source="WinEventLog:Security" EventCode="4688") Image="*at.exe"DS0003Scheduled JobScheduled Job CreationMonitor for newly constructed scheduled jobs. If scheduled tasks are not used for persistence, then the adversary is likely to remove the task when the action is complete. On Windows, enable the "Microsoft-Windows-TaskScheduler/Operational" setting within the event logging service where several events will then be logged on scheduled task activity, including:[16]Event ID 106 on Windows 7, Server 2008 R2 - Scheduled task registeredEvent ID 4698 on Windows 10, Server 2016 - Scheduled task createdEvent ID 4700 on Windows 10, Server 2016 - Scheduled task enabledEvent ID 4701 on Windows 10, Server 2016 - Scheduled task disabledTools such as Sysinternals Autoruns may also be used to detect system changes that could be attempts at persistence, including listing current scheduled tasks.[17]ReferencesIEEE/The Open Group. (2017). at(1p) — Linux manual page. Retrieved February 25, 2022.Emilio Pinna, Andrea Cardaci. (n.d.). gtfobins at. Retrieved September 28, 2021.Carvey, H.. (2014, September 2). Where you AT?: Indicators of lateral movement using at.exe on Windows 7 systems. Retrieved January 25, 2016.Microsoft. (n.d.). At. Retrieved April 28, 2016.Counter Threat Unit Research Team. (2017, October 12). BRONZE BUTLER Targets Japanese Enterprises. Retrieved January 4, 2018.byt3bl33d3r. (2018, September 8). SMB: Command Reference. Retrieved July 17, 2020.FireEye. (2018, March 16). Suspected Chinese Cyber Espionage Group (TEMP.Periscope) Targeting U.S. Engineering and Maritime Industries. Retrieved April 11, 2018.Dell SecureWorks Counter Threat Unit Threat Intelligence. (2015, August 5). Threat Group-3390 Targets Organizations for Cyberespionage. Retrieved August 18, 2018.PowerSploit. (n.d.). Retrieved December 4, 2014.Carvey, H.. (2014, September). Where You AT?: Indicators of Lateral Movement Using at.exe on Windows 7 Systems. Retrieved November 27, 2019.Koromicha. (2019, September 7). Scheduling tasks using at command in Linux. Retrieved December 3, 2019.Microsoft. (2012, November 15). Domain controller: Allow server operators to schedule tasks. Retrieved December 18, 2017.Microsoft. (2013, May 8). Increase scheduling priority. Retrieved December 18, 2017.Craig Rowland. (2019, July 25). Getting an Attacker IP Address from a Malicious Linux At Job. Retrieved October 15, 2021.Loobeek, L. (2017, December 8). leoloobeek Status. Retrieved December 12, 2017.Satyajit321. (2015, November 3). Scheduled Tasks History Retention settings. Retrieved December 12, 2017.Russinovich, M. (2016, January 4). Autoruns for Windows v13.51. Retrieved June 6, 2016.×load more resultsContact UsTerms of UsePrivacy PolicyWebsite Changelog© 2015 - 2024, The MITRE Corporation. MITRE ATT&CK and ATT&CK are registered trademarks of The MITRE Corporation.