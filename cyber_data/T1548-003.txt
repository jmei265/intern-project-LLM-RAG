MatricesEnterpriseMobileICSTacticsEnterpriseMobileICSTechniquesEnterpriseMobileICSDefensesData SourcesMitigationsEnterpriseMobileICSAssetsCTIGroupsSoftwareCampaignsResourcesGet StartedLearn More about ATT&CKATT&CKconATT&CK Data & ToolsFAQEngage with ATT&CKVersion HistoryLegal & BrandingBenefactorsBlogSearchATT&CKcon 5.0 returns October 22-23, 2024 in McLean, VA.Register heretoday!HomeTechniquesEnterpriseAbuse Elevation Control MechanismSudo and Sudo CachingAbuse Elevation Control Mechanism:Sudo and Sudo CachingOther sub-techniques of Abuse Elevation Control Mechanism (6)IDNameT1548.001Setuid and SetgidT1548.002Bypass User Account ControlT1548.003Sudo and Sudo CachingT1548.004Elevated Execution with PromptT1548.005Temporary Elevated Cloud AccessT1548.006TCC ManipulationAdversaries may perform sudo caching and/or use the sudoers file to elevate privileges. Adversaries may do this to execute commands as other users or spawn processes with higher privileges.Within Linux and MacOS systems, sudo (sometimes referred to as "superuser do") allows users to perform commands from terminals with elevated privileges and to control who can perform these commands on the system. Thesudocommand "allows a system administrator to delegate authority to give certain users (or groups of users) the ability to run some (or all) commands as root or another user while providing an audit trail of the commands and their arguments."[1]Since sudo was made for the system administrator, it has some useful configuration features such as atimestamp_timeout, which is the amount of time in minutes between instances ofsudobefore it will re-prompt for a password. This is becausesudohas the ability to cache credentials for a period of time. Sudo creates (or touches) a file at/var/db/sudowith a timestamp of when sudo was last run to determine this timeout. Additionally, there is atty_ticketsvariable that treats each new tty (terminal session) in isolation. This means that, for example, the sudo timeout of one tty will not affect another tty (you will have to type the password again).The sudoers file,/etc/sudoers, describes which users can run which commands and from which terminals. This also describes which commands users can run as other users or groups. This provides the principle of least privilege such that users are running in their lowest possible permissions for most of the time and only elevate to other users or permissions as needed, typically by prompting for a password. However, the sudoers file can also specify when to not prompt users for passwords with a line likeuser1 ALL=(ALL) NOPASSWD: ALL.[2]Elevated privileges are required to edit this file though.Adversaries can also abuse poor configurations of these mechanisms to escalate privileges without needing the user's password. For example,/var/db/sudo's timestamp can be monitored to see if it falls within thetimestamp_timeoutrange. If it does, then malware can execute sudo commands without needing to supply the user's password. Additional, iftty_ticketsis disabled, adversaries can do this from any tty for that user.In the wild, malware has disabledtty_ticketsto potentially make scripting easier by issuingecho \'Defaults !tty_tickets\' >> /etc/sudoers.[3]In order for this change to be reflected, the malware also issuedkillall Terminal. As of macOS Sierra, the sudoers file hastty_ticketsenabled by default.ID:T1548.003Sub-technique of:T1548ⓘTactics:Privilege Escalation,Defense EvasionⓘPlatforms:Linux, macOSⓘPermissions Required:UserⓘEffective Permissions:rootVersion:1.0Created:30 January 2020Last Modified:14 March 2022Version PermalinkLive VersionProcedure ExamplesIDNameDescriptionS0154Cobalt StrikeCobalt Strikecan usesudoto run a command.[4]S0281DokDokaddsadmin  ALL=(ALL) NOPASSWD: ALLto the/etc/sudoersfile.[5]S0279ProtonProtonmodifies the tty_tickets line in the sudoers file.[6]MitigationsIDMitigationDescriptionM1028Operating System ConfigurationEnsuring that thetty_ticketssetting is enabled will prevent this leakage across tty sessions.M1026Privileged Account ManagementBy requiring a password, even if an adversary can get terminal access, they must know the password to run anything in the sudoers file. Setting thetimestamp_timeoutto 0 will require the user to input their password every timesudois executed.M1022Restrict File and Directory PermissionsThe sudoers file should be strictly edited such that passwords are always required and that users can't spawn risky processes as users with higher privilege.DetectionIDData SourceData ComponentDetectsDS0017CommandCommand ExecutionMonitor executed commands and arguments that may perform sudo caching and/or use the suoders file to elevate privileges, such as thesudocommand.DS0022FileFile ModificationOn Linux, auditd can alert every time a user's actual ID and effective ID are different (this is what happens when you sudo). This technique is abusing normal functionality in macOS and Linux systems, but sudo has the ability to log all input and output based on theLOG_INPUTandLOG_OUTPUTdirectives in the/etc/sudoersfile.DS0009ProcessProcess CreationMonitor newly executed processes that may perform sudo caching and/or use the suoders file to elevate privileges.Process MetadataMonitor contextual data about a running process, which may include information such as environment variables, image name, user/owner that may perform sudo caching and/or use the suoders file to elevate privileges.ReferencesTodd C. Miller. (2018). Sudo Man Page. Retrieved March 19, 2018.Thomas Reed. (2017, July 7). New OSX.Dok malware intercepts web traffic. Retrieved July 10, 2017.Amit Serper. (2018, May 10). ProtonB What this Mac Malware Actually Does. Retrieved March 19, 2018.Strategic Cyber LLC. (2020, November 5). Cobalt Strike: Advanced Threat Tactics for Penetration Testers. Retrieved April 13, 2021.fluffybunny. (2019, July 9). OSX.Dok Analysis. Retrieved October 4, 2021.Patrick Wardle. (n.d.). Mac Malware of 2017. Retrieved September 21, 2018.×load more resultsContact UsTerms of UsePrivacy PolicyWebsite Changelog© 2015 - 2024, The MITRE Corporation. MITRE ATT&CK and ATT&CK are registered trademarks of The MITRE Corporation.